{"id":"SOL-ISS-20260127-001-h7k2","description":"重构 FloatingWindow 中的 HttpClient 使用，通过依赖注入获取共享实例","approach":"FloatingWindow.xaml.cs 中 LoadMonitoringSettingsAsync 方法直接 new HttpClient()，应改为通过 IServiceDiscovery 或注入的 HttpClient 实例。由于 FloatingWindow 是 WPF 窗口，可以通过 App.xaml.cs 中的 ServiceProvider 获取 HttpClient。","tasks":[{"id":"TASK-1","title":"修改 FloatingWindow 使用注入的 HttpClient","description":"将 FloatingWindow.xaml.cs 中的 new HttpClient() 替换为通过 ServiceProvider 获取的共享实例","modification_points":[{"file":"XhMonitor.Desktop/FloatingWindow.xaml.cs","changes":[{"line":248,"old":"using var httpClient = new System.Net.Http.HttpClient();","new":"使用 App.Current.Services.GetRequiredService<HttpClient>() 或通过构造函数注入"}]}],"implementation":["1. 在 FloatingWindow 类中添加私有字段 _httpClient","2. 修改构造函数，从 App.Current.Services 获取 HttpClient 实例","3. 将 LoadMonitoringSettingsAsync 中的 using var httpClient = new HttpClient() 替换为 _httpClient","4. 移除 using 语句，因为共享的 HttpClient 不应被 dispose"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Desktop"]},"acceptance":{"criteria":["FloatingWindow 中不再有 new HttpClient() 调用","HttpClient 通过 DI 容器获取","应用正常启动，监控设置正常加载"],"verification":["grep -r 'new.*HttpClient' XhMonitor.Desktop/FloatingWindow.xaml.cs 返回空","运行应用，验证悬浮窗正常显示监控数据"]},"commit":{"type":"fix","scope":"desktop","message_template":"fix(desktop): 重构 FloatingWindow 使用共享 HttpClient 实例"},"depends_on":[],"priority":2}],"analysis":{"risk":"low","impact":"low","complexity":"low"},"score":0.9,"is_bound":true,"bound_at":"2026-01-27T02:56:07.992Z"}
