{"id":"SOL-DSC-20260119-150946-003-k7m2","description":"Extract ISystemMetricProvider interface to enable dependency inversion and improve testability","approach":"Create ISystemMetricProvider interface with all public methods from SystemMetricProvider, update Worker to depend on the interface instead of concrete class, register interface in DI container","analysis":{"risk":"low","impact":"low","complexity":"low"},"score":0.95,"tasks":[{"id":"T1","title":"Create ISystemMetricProvider interface","scope":"XhMonitor.Core/Interfaces","action":"Create","description":"Extract interface from SystemMetricProvider to enable dependency inversion principle","modification_points":[{"file":"XhMonitor.Core/Interfaces/ISystemMetricProvider.cs","target":"new file","change":"Define interface with WarmupAsync(), GetHardwareLimitsAsync(), GetSystemUsageAsync() methods"}],"implementation":["Create new file XhMonitor.Core/Interfaces/ISystemMetricProvider.cs","Define interface ISystemMetricProvider with three methods:","  - Task WarmupAsync() - for performance counter warmup","  - Task<HardwareLimits> GetHardwareLimitsAsync() - for max memory/VRAM","  - Task<SystemUsage> GetSystemUsageAsync() - for current system usage","Add XML documentation comments for each method","Ensure HardwareLimits and SystemUsage types are accessible (they are in XhMonitor.Core.Providers namespace)"],"test":{"unit":["Verify interface compiles successfully","Verify interface is in XhMonitor.Core.Interfaces namespace","Verify all three methods are defined with correct signatures"],"commands":["dotnet build XhMonitor.Core"]},"acceptance":{"criteria":["Interface ISystemMetricProvider exists in XhMonitor.Core/Interfaces","Interface defines exactly 3 methods: WarmupAsync, GetHardwareLimitsAsync, GetSystemUsageAsync","All methods have Task return types","Interface compiles without errors"],"verification":["Check file exists at XhMonitor.Core/Interfaces/ISystemMetricProvider.cs","Verify dotnet build succeeds","Verify interface signature matches SystemMetricProvider public methods"]},"commit":{"type":"refactor","scope":"core","message_template":"refactor(core): extract ISystemMetricProvider interface for dependency inversion"},"depends_on":[],"priority":1},{"id":"T2","title":"Update SystemMetricProvider to implement interface","scope":"XhMonitor.Core/Providers","action":"Update","description":"Make SystemMetricProvider implement ISystemMetricProvider interface","modification_points":[{"file":"XhMonitor.Core/Providers/SystemMetricProvider.cs","target":"class declaration line 14","change":"Add : ISystemMetricProvider to class declaration"}],"implementation":["Open XhMonitor.Core/Providers/SystemMetricProvider.cs","Add using statement: using XhMonitor.Core.Interfaces;","Update class declaration from 'public class SystemMetricProvider : IDisposable' to 'public class SystemMetricProvider : ISystemMetricProvider, IDisposable'","Verify all interface methods are already public (WarmupAsync, GetHardwareLimitsAsync, GetSystemUsageAsync)","No method signature changes needed - existing public methods already match interface"],"test":{"unit":["Verify SystemMetricProvider compiles successfully","Verify class implements ISystemMetricProvider","Verify existing functionality unchanged"],"commands":["dotnet build XhMonitor.Core"]},"acceptance":{"criteria":["SystemMetricProvider implements ISystemMetricProvider","All interface methods remain public and unchanged","Class compiles without errors","No breaking changes to existing functionality"],"verification":["Check class declaration includes ISystemMetricProvider","Verify dotnet build succeeds","Run existing tests to ensure no regression"]},"commit":{"type":"refactor","scope":"core","message_template":"refactor(core): implement ISystemMetricProvider in SystemMetricProvider"},"depends_on":["T1"],"priority":2},{"id":"T3","title":"Update Worker to depend on ISystemMetricProvider","scope":"XhMonitor.Service","action":"Update","description":"Change Worker constructor to accept ISystemMetricProvider instead of concrete SystemMetricProvider","modification_points":[{"file":"XhMonitor.Service/Worker.cs","target":"field declaration line 18","change":"Change type from SystemMetricProvider to ISystemMetricProvider"},{"file":"XhMonitor.Service/Worker.cs","target":"constructor parameter line 36","change":"Change parameter type from SystemMetricProvider to ISystemMetricProvider"}],"implementation":["Open XhMonitor.Service/Worker.cs","Add using statement: using XhMonitor.Core.Interfaces;","Update field declaration at line 18 from 'private readonly SystemMetricProvider _systemMetricProvider;' to 'private readonly ISystemMetricProvider _systemMetricProvider;'","Update constructor parameter at line 36 from 'SystemMetricProvider systemMetricProvider' to 'ISystemMetricProvider systemMetricProvider'","No other changes needed - all usages of _systemMetricProvider call interface methods"],"test":{"unit":["Verify Worker compiles successfully","Verify Worker can be instantiated with ISystemMetricProvider mock","Verify all _systemMetricProvider usages still work"],"commands":["dotnet build XhMonitor.Service"]},"acceptance":{"criteria":["Worker field _systemMetricProvider has type ISystemMetricProvider","Worker constructor accepts ISystemMetricProvider parameter","Worker compiles without errors","All existing _systemMetricProvider method calls remain valid"],"verification":["Check field and parameter types are ISystemMetricProvider","Verify dotnet build succeeds","Verify Worker can be unit tested with mock implementation"]},"commit":{"type":"refactor","scope":"service","message_template":"refactor(service): use ISystemMetricProvider in Worker for dependency inversion"},"depends_on":["T2"],"priority":3},{"id":"T4","title":"Update DI registration in Program.cs","scope":"XhMonitor.Service","action":"Update","description":"Register ISystemMetricProvider interface in dependency injection container","modification_points":[{"file":"XhMonitor.Service/Program.cs","target":"SystemMetricProvider registration around line 125","change":"Change from AddSingleton<SystemMetricProvider> to AddSingleton<ISystemMetricProvider, SystemMetricProvider>"}],"implementation":["Open XhMonitor.Service/Program.cs","Locate SystemMetricProvider registration (around line 125-137)","Change registration from:","  builder.Services.AddSingleton<SystemMetricProvider>(sp => { ... })","To:","  builder.Services.AddSingleton<ISystemMetricProvider, SystemMetricProvider>(sp => { ... })","Keep the factory lambda unchanged - it still creates SystemMetricProvider instance","Verify no other code depends on resolving concrete SystemMetricProvider type"],"test":{"unit":["Verify Program.cs compiles successfully","Verify DI container can resolve ISystemMetricProvider","Verify Worker receives correct instance at runtime"],"commands":["dotnet build XhMonitor.Service","dotnet test XhMonitor.Tests"]},"acceptance":{"criteria":["DI registration uses AddSingleton<ISystemMetricProvider, SystemMetricProvider>","Factory lambda creates SystemMetricProvider instance","Worker successfully receives ISystemMetricProvider via DI","Application starts without DI resolution errors"],"verification":["Check registration syntax is correct","Verify dotnet build succeeds","Run application and verify Worker initializes correctly","Check logs for DI resolution errors"]},"commit":{"type":"refactor","scope":"service","message_template":"refactor(service): register ISystemMetricProvider in DI container"},"depends_on":["T3"],"priority":4}],"is_bound":true,"bound_at":"2026-01-19T16:19:31.700Z"}
