{"id":"SOL-ISS-20260127-003-k8m2","description":"重构 MonitorDbContext 种子数据，使用常量类定义 ID 避免硬编码冲突风险","approach":"EF Core 的 HasData 方法要求种子数据必须有显式 ID（不支持自动递增）。解决方案是创建一个 SeedDataIds 常量类，集中管理所有种子数据的 ID 值。这样做的好处：1) ID 值有单一来源，便于维护和审查；2) 使用有意义的常量名称提高可读性；3) 如果需要调整 ID 范围，只需修改一处；4) 添加 XML 注释说明 ID 分配策略，避免未来冲突。同时在 MonitorDbContext 中添加注释说明种子数据 ID 的设计决策。","tasks":[{"id":"T1","title":"创建 SeedDataIds 常量类","scope":"XhMonitor.Service/Data","action":"Create","description":"创建 SeedDataIds.cs 文件，定义所有种子数据的 ID 常量","modification_points":[{"file":"XhMonitor.Service/Data/SeedDataIds.cs","target":"新文件","change":"创建常量类，包含 ApplicationSettings 和 AlertConfiguration 的 ID 常量"}],"implementation":["在 XhMonitor.Service/Data 目录下创建 SeedDataIds.cs","定义 internal static class SeedDataIds","添加 ApplicationSettings 嵌套类，包含所有配置项的 ID 常量（ThemeColor=1, Opacity=2, ProcessKeywords=3, TopProcessCount=6, DataRetentionDays=7, StartWithWindows=8, MonitorCpu=9, MonitorMemory=10, MonitorGpu=11, MonitorVram=12, MonitorPower=13, MonitorNetwork=14, AdminMode=15）","添加 AlertConfiguration 嵌套类，包含所有告警配置的 ID 常量（Cpu=1, Memory=2, Gpu=3, Vram=4）","添加 XML 注释说明 ID 分配策略：ApplicationSettings 使用 1-100 范围，AlertConfiguration 使用 1-100 范围"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Service"]},"acceptance":{"criteria":["SeedDataIds.cs 文件创建成功","包含 ApplicationSettings 和 AlertConfiguration 两个嵌套类","所有 ID 常量与当前 MonitorDbContext 中的硬编码值一致","XML 注释说明 ID 分配策略"]},"commit":{"type":"refactor","scope":"Service","message_template":"refactor(Service): 创建 SeedDataIds 常量类集中管理种子数据 ID"},"depends_on":[],"priority":1},{"id":"T2","title":"重构 MonitorDbContext 使用 SeedDataIds","scope":"XhMonitor.Service/Data/MonitorDbContext.cs","action":"Update","description":"将 MonitorDbContext 中的硬编码 ID 替换为 SeedDataIds 常量引用","modification_points":[{"file":"XhMonitor.Service/Data/MonitorDbContext.cs","target":"ApplicationSettings HasData (line 77-100)","change":"将 Id = 1, Id = 2 等硬编码值替换为 SeedDataIds.ApplicationSettings.ThemeColor 等常量"},{"file":"XhMonitor.Service/Data/MonitorDbContext.cs","target":"AlertConfiguration HasData (line 102-138)","change":"将 Id = 1, Id = 2 等硬编码值替换为 SeedDataIds.AlertConfiguration.Cpu 等常量"}],"implementation":["在 MonitorDbContext.cs 顶部确认已有 using XhMonitor.Service.Data 命名空间（SeedDataIds 在同一命名空间）","在 ApplicationSettings HasData 中，将 Id = 1 替换为 Id = SeedDataIds.ApplicationSettings.ThemeColor","依次替换所有 ApplicationSettings 的 ID 引用","在 AlertConfiguration HasData 中，将 Id = 1 替换为 Id = SeedDataIds.AlertConfiguration.Cpu","依次替换所有 AlertConfiguration 的 ID 引用","在种子数据区域添加注释说明 ID 由 SeedDataIds 类管理"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Service","dotnet ef migrations list --project XhMonitor.Service"]},"acceptance":{"criteria":["MonitorDbContext 中不再有硬编码的种子数据 ID","所有 ID 引用使用 SeedDataIds 常量","代码编译通过","EF 迁移列表正常显示（无新迁移生成，因为值未变）"]},"commit":{"type":"refactor","scope":"Service","message_template":"refactor(Service): MonitorDbContext 种子数据使用 SeedDataIds 常量\n\n- 替换 ApplicationSettings 硬编码 ID 为常量引用\n- 替换 AlertConfiguration 硬编码 ID 为常量引用\n- 添加注释说明 ID 管理策略\n\nCloses ISS-20260127-003"},"depends_on":["T1"],"priority":2}],"analysis":{"risk":"low","impact":"low","complexity":"low"},"score":0.9,"is_bound":true,"bound_at":"2026-01-27T02:57:10.212Z"}
