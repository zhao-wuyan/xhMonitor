{"id":"SOL-ISS-1769239097521-9-b2k4","description":"Replace synchronous SemaphoreSlim.Wait() with async WaitAsync() to prevent thread pool starvation in LibreHardwareManager","approach":"Convert EnsureSnapshotFresh() from synchronous to async method, replacing _updateLock.Wait() with await _updateLock.WaitAsync(). Update all callers to use async/await pattern. This prevents thread pool starvation and follows async best practices. The change is isolated to LibreHardwareManager and its interface.","analysis":{"risk":"medium","impact":"medium","complexity":"medium"},"score":0.85,"tasks":[{"id":"T1","title":"Convert EnsureSnapshotFresh to async method","scope":"XhMonitor.Core/Services","action":"Update","description":"Convert EnsureSnapshotFresh() to async and replace synchronous Wait() with WaitAsync()","modification_points":["XhMonitor.Core/Services/LibreHardwareManager.cs:78-121 - EnsureSnapshotFresh() method","XhMonitor.Core/Services/LibreHardwareManager.cs:86 - _updateLock.WaitAsync(0).GetAwaiter().GetResult() to await _updateLock.WaitAsync(0)"],"implementation":["Change method signature from 'private void EnsureSnapshotFresh()' to 'private async Task EnsureSnapshotFreshAsync()'","Replace '_updateLock.WaitAsync(0).GetAwaiter().GetResult()' with 'await _updateLock.WaitAsync(0)' at line 86","Keep the rest of the method logic unchanged","Verify the async pattern is correct"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Core/XhMonitor.Core.csproj"]},"acceptance":{"criteria":["EnsureSnapshotFresh converted to async method","Synchronous Wait replaced with async WaitAsync","Code compiles without errors","Method signature updated to return Task"],"verification":["Verify method signature is 'private async Task EnsureSnapshotFreshAsync()'","Verify WaitAsync is awaited properly","Run dotnet build to confirm compilation"]},"commit":{"type":"refactor","scope":"core/services","message_template":"refactor(core/services): convert EnsureSnapshotFresh to async method\n\nReplace synchronous SemaphoreSlim.Wait() with async WaitAsync() to prevent\nthread pool starvation. Part 1 of async conversion."},"depends_on":[],"priority":1},{"id":"T2","title":"Update GetSensorValue to async","scope":"XhMonitor.Core/Services","action":"Update","description":"Convert GetSensorValue() to async and update call to EnsureSnapshotFreshAsync()","modification_points":["XhMonitor.Core/Services/LibreHardwareManager.cs:123-149 - GetSensorValue() method","XhMonitor.Core/Services/LibreHardwareManager.cs:132 - EnsureSnapshotFresh() call"],"implementation":["Change method signature from 'public float? GetSensorValue(...)' to 'public async Task<float?> GetSensorValueAsync(...)'","Replace 'EnsureSnapshotFresh()' with 'await EnsureSnapshotFreshAsync()' at line 132","Keep the rest of the method logic unchanged"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Core/XhMonitor.Core.csproj"]},"acceptance":{"criteria":["GetSensorValue converted to async method","Call to EnsureSnapshotFreshAsync is awaited","Code compiles without errors","Return type is Task<float?>"],"verification":["Verify method signature returns Task<float?>","Verify EnsureSnapshotFreshAsync is awaited","Run dotnet build"]},"commit":{"type":"refactor","scope":"core/services","message_template":"refactor(core/services): convert GetSensorValue to async\n\nUpdate GetSensorValue to use async EnsureSnapshotFreshAsync. Part 2 of async conversion."},"depends_on":["T1"],"priority":2},{"id":"T3","title":"Update GetAllSensorValues to async","scope":"XhMonitor.Core/Services","action":"Update","description":"Convert GetAllSensorValues() to async and update call to EnsureSnapshotFreshAsync()","modification_points":["XhMonitor.Core/Services/LibreHardwareManager.cs:151-178 - GetAllSensorValues() method","XhMonitor.Core/Services/LibreHardwareManager.cs:162 - EnsureSnapshotFresh() call"],"implementation":["Change method signature from 'public List<float> GetAllSensorValues(...)' to 'public async Task<List<float>> GetAllSensorValuesAsync(...)'","Replace 'EnsureSnapshotFresh()' with 'await EnsureSnapshotFreshAsync()' at line 162","Keep the rest of the method logic unchanged"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Core/XhMonitor.Core.csproj"]},"acceptance":{"criteria":["GetAllSensorValues converted to async method","Call to EnsureSnapshotFreshAsync is awaited","Code compiles without errors","Return type is Task<List<float>>"],"verification":["Verify method signature returns Task<List<float>>","Verify EnsureSnapshotFreshAsync is awaited","Run dotnet build"]},"commit":{"type":"refactor","scope":"core/services","message_template":"refactor(core/services): convert GetAllSensorValues to async\n\nUpdate GetAllSensorValues to use async EnsureSnapshotFreshAsync. Part 3 of async conversion."},"depends_on":["T2"],"priority":3},{"id":"T4","title":"Update GetSensorValues to async","scope":"XhMonitor.Core/Services","action":"Update","description":"Convert GetSensorValues() to async and update call to EnsureSnapshotFreshAsync()","modification_points":["XhMonitor.Core/Services/LibreHardwareManager.cs:180-207 - GetSensorValues() method","XhMonitor.Core/Services/LibreHardwareManager.cs:192 - EnsureSnapshotFresh() call"],"implementation":["Change method signature from 'public IReadOnlyList<SensorReading> GetSensorValues(...)' to 'public async Task<IReadOnlyList<SensorReading>> GetSensorValuesAsync(...)'","Replace 'EnsureSnapshotFresh()' with 'await EnsureSnapshotFreshAsync()' at line 192","Keep the rest of the method logic unchanged"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Core/XhMonitor.Core.csproj"]},"acceptance":{"criteria":["GetSensorValues converted to async method","Call to EnsureSnapshotFreshAsync is awaited","Code compiles without errors","Return type is Task<IReadOnlyList<SensorReading>>"],"verification":["Verify method signature returns Task<IReadOnlyList<SensorReading>>","Verify EnsureSnapshotFreshAsync is awaited","Run dotnet build"]},"commit":{"type":"refactor","scope":"core/services","message_template":"refactor(core/services): convert GetSensorValues to async\n\nUpdate GetSensorValues to use async EnsureSnapshotFreshAsync. Part 4 of async conversion."},"depends_on":["T3"],"priority":4},{"id":"T5","title":"Update GetSensorValueByName to async","scope":"XhMonitor.Core/Services","action":"Update","description":"Convert GetSensorValueByName() to async and update call to EnsureSnapshotFreshAsync()","modification_points":["XhMonitor.Core/Services/LibreHardwareManager.cs:220-248 - GetSensorValueByName() method","XhMonitor.Core/Services/LibreHardwareManager.cs:229 - EnsureSnapshotFresh() call"],"implementation":["Change method signature from 'public float? GetSensorValueByName(...)' to 'public async Task<float?> GetSensorValueByNameAsync(...)'","Replace 'EnsureSnapshotFresh()' with 'await EnsureSnapshotFreshAsync()' at line 229","Keep the rest of the method logic unchanged"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Core/XhMonitor.Core.csproj"]},"acceptance":{"criteria":["GetSensorValueByName converted to async method","Call to EnsureSnapshotFreshAsync is awaited","Code compiles without errors","Return type is Task<float?>"],"verification":["Verify method signature returns Task<float?>","Verify EnsureSnapshotFreshAsync is awaited","Run dotnet build"]},"commit":{"type":"refactor","scope":"core/services","message_template":"refactor(core/services): convert GetSensorValueByName to async\n\nUpdate GetSensorValueByName to use async EnsureSnapshotFreshAsync. Part 5 of async conversion."},"depends_on":["T4"],"priority":5},{"id":"T6","title":"Update ILibreHardwareManager interface","scope":"XhMonitor.Core/Interfaces","action":"Update","description":"Update ILibreHardwareManager interface to reflect async method signatures","modification_points":["XhMonitor.Core/Interfaces/ILibreHardwareManager.cs - All method signatures"],"implementation":["Update GetSensorValue signature to Task<float?> GetSensorValueAsync(...)","Update GetAllSensorValues signature to Task<List<float>> GetAllSensorValuesAsync(...)","Update GetSensorValues signature to Task<IReadOnlyList<SensorReading>> GetSensorValuesAsync(...)","Update GetSensorValueByName signature to Task<float?> GetSensorValueByNameAsync(...)","Verify interface matches implementation"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Core/XhMonitor.Core.csproj"]},"acceptance":{"criteria":["All method signatures updated to async","Interface matches LibreHardwareManager implementation","Code compiles without errors"],"verification":["Verify all methods return Task<T>","Verify method names end with Async","Run dotnet build"]},"commit":{"type":"refactor","scope":"core/interfaces","message_template":"refactor(core/interfaces): update ILibreHardwareManager to async\n\nUpdate interface to match async implementation of LibreHardwareManager."},"depends_on":["T5"],"priority":6},{"id":"T7","title":"Update all callers to use async methods","scope":"XhMonitor.Core","action":"Update","description":"Update all code that calls LibreHardwareManager methods to use async versions","modification_points":["Search for all usages of GetSensorValue, GetAllSensorValues, GetSensorValues, GetSensorValueByName","Update callers to await async versions"],"implementation":["Use grep to find all callers: GetSensorValue, GetAllSensorValues, GetSensorValues, GetSensorValueByName","Update each caller to use async version with await","Ensure calling methods are also async","Update tests to use async test methods"],"test":{"unit":[],"commands":["dotnet build","dotnet test XhMonitor.Tests/XhMonitor.Tests.csproj --filter LibreHardwareManager"]},"acceptance":{"criteria":["All callers updated to use async methods","All calling methods are async where needed","All tests pass","No compilation errors"],"verification":["Grep for old method names to ensure none remain","Run full test suite","Verify no synchronous blocking (.Result, .Wait())"]},"commit":{"type":"refactor","scope":"core","message_template":"refactor(core): update all callers to use async LibreHardwareManager methods\n\nComplete async conversion by updating all call sites to use async/await pattern.\nPrevents thread pool starvation from synchronous semaphore waits."},"depends_on":["T6"],"priority":7}],"is_bound":true,"bound_at":"2026-01-24T07:40:10.905Z"}
