{"id":"SOL-ISS-1769239097521-17-k9p4","description":"Replace fixed provider fields with collection-based management for dynamic extensibility","approach":"Replace individual provider fields (_cpuProvider, _gpuProvider, etc.) with a Dictionary<string, IMetricProvider> collection. This enables dynamic registration of new metric types without modifying SystemMetricProvider class structure. Maintains backward compatibility through helper methods for accessing standard providers.","analysis":{"risk":"low","impact":"high","complexity":"low"},"score":0.95,"tasks":[{"id":"T1","title":"Replace provider fields with collection","scope":"XhMonitor.Core/Providers","action":"Update","description":"Replace individual provider fields with Dictionary-based collection in SystemMetricProvider","modification_points":["XhMonitor.Core/Providers/SystemMetricProvider.cs"],"implementation":["Replace _cpuProvider, _gpuProvider, _memoryProvider, _vramProvider fields with Dictionary<string, IMetricProvider> _providers","Update constructor to accept IEnumerable<IMetricProvider> or Dictionary<string, IMetricProvider>","Populate _providers dictionary using MetricId as key","Add helper methods: GetProvider(string metricId), HasProvider(string metricId)","Update WarmupAsync() to iterate _providers.Values instead of checking specific types","Update GetSystemUsageAsync() to use GetProvider(\"cpu\"), GetProvider(\"gpu\"), etc."],"test":{"unit":["Test constructor accepts provider collection","Test GetProvider returns correct provider by MetricId","Test HasProvider returns true for registered providers","Test WarmupAsync calls WarmupAsync on all warmup-capable providers","Test GetSystemUsageAsync retrieves metrics from correct providers"],"commands":["dotnet test XhMonitor.Tests --filter SystemMetricProviderTests"]},"acceptance":{"criteria":["_providers Dictionary replaces individual fields","Constructor accepts provider collection","GetProvider/HasProvider methods work correctly","WarmupAsync iterates all providers","GetSystemUsageAsync uses GetProvider() calls","All existing tests pass"],"verification":["Code review confirms no hardcoded provider fields","Run unit tests and confirm 100% pass rate","Verify no behavioral changes to existing functionality"]},"commit":{"type":"refactor","scope":"providers","message_template":"refactor(providers): use collection-based provider management\n\nReplace fixed fields with Dictionary for dynamic provider registration.\nEnables adding new metric types without class modifications."},"depends_on":[],"priority":1},{"id":"T2","title":"Update constructor signature","scope":"XhMonitor.Core/Providers","action":"Update","description":"Simplify constructor to accept provider collection instead of individual parameters","modification_points":["XhMonitor.Core/Providers/SystemMetricProvider.cs"],"implementation":["Change constructor signature: SystemMetricProvider(IEnumerable<IMetricProvider> providers, ILogger<SystemMetricProvider>? logger = null)","Remove individual provider parameters (cpuProvider, gpuProvider, memoryProvider, vramProvider)","Initialize _providers dictionary from providers enumerable using MetricId as key","Keep logger parameter unchanged","Add validation: log warning if duplicate MetricId found"],"test":{"unit":["Test constructor with empty provider collection","Test constructor with multiple providers","Test constructor handles duplicate MetricId gracefully","Test constructor preserves logger parameter"],"commands":["dotnet test XhMonitor.Tests --filter SystemMetricProviderTests"]},"acceptance":{"criteria":["Constructor accepts IEnumerable<IMetricProvider>","Individual provider parameters removed","_providers populated from enumerable","Duplicate MetricId handling implemented","Logger parameter preserved","All tests pass"],"verification":["Verify constructor signature matches specification","Run unit tests and confirm 100% pass rate","Check duplicate MetricId logs warning"]},"commit":{"type":"refactor","scope":"providers","message_template":"refactor(providers): simplify SystemMetricProvider constructor\n\nAccept provider collection instead of individual parameters.\nSupports dynamic provider registration."},"depends_on":["T1"],"priority":2},{"id":"T3","title":"Update DI registration in Program.cs","scope":"XhMonitor.Service","action":"Update","description":"Update dependency injection to pass provider collection to SystemMetricProvider","modification_points":["XhMonitor.Service/Program.cs"],"implementation":["Update SystemMetricProvider registration (lines 141-153)","Change from individual provider parameters to collection","Use registry.GetAllProviders() or manually build provider list","Pass providers as IEnumerable<IMetricProvider> to constructor","Ensure cpu, gpu, memory, vram providers included","Remove individual GetProvider() calls"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Service","dotnet test XhMonitor.Tests --filter IntegrationTests"]},"acceptance":{"criteria":["SystemMetricProvider registration updated","Provider collection passed to constructor","All standard providers (cpu, gpu, memory, vram) included","Application builds successfully","Integration tests pass","VRAM metrics work correctly"],"verification":["Build succeeds without errors","Run application and verify all metrics work","Check logs confirm all providers registered"]},"commit":{"type":"refactor","scope":"di","message_template":"refactor(di): update SystemMetricProvider registration for collection-based providers\n\nPass provider collection instead of individual parameters."},"depends_on":["T2"],"priority":3},{"id":"T4","title":"Add GetAllProviders to MetricProviderRegistry","scope":"XhMonitor.Service/Core","action":"Update","description":"Add helper method to MetricProviderRegistry for retrieving all registered providers","modification_points":["XhMonitor.Service/Core/MetricProviderRegistry.cs"],"implementation":["Add GetAllProviders() method returning IEnumerable<IMetricProvider>","Return all providers from internal registry","Add optional filter parameter: GetAllProviders(Func<IMetricProvider, bool>? filter = null)","Document method for use in SystemMetricProvider DI registration"],"test":{"unit":["Test GetAllProviders returns all registered providers","Test GetAllProviders with filter returns subset","Test GetAllProviders returns empty when no providers registered"],"commands":["dotnet test XhMonitor.Tests --filter MetricProviderRegistryTests"]},"acceptance":{"criteria":["GetAllProviders method added","Returns all registered providers","Optional filter parameter works","Method documented","All tests pass"],"verification":["Verify method returns correct provider collection","Run unit tests and confirm 100% pass rate","Check method used in Program.cs DI registration"]},"commit":{"type":"feat","scope":"registry","message_template":"feat(registry): add GetAllProviders method to MetricProviderRegistry\n\nSupports collection-based provider retrieval for SystemMetricProvider."},"depends_on":[],"priority":1}],"is_bound":true,"bound_at":"2026-01-24T07:39:57.949Z"}
