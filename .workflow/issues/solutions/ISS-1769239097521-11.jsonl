{"id":"SOL-ISS-1769239097521-11-a7x9","description":"Add structured logging to empty catch blocks in SignalRService to improve debugging and error visibility","approach":"Replace empty catch block at line 141-144 in SignalRService.cs with proper logging using ILogger. The current implementation silently swallows exceptions during connection stop, making it impossible to diagnose connection issues. This solution adds structured logging while maintaining the non-throwing behavior required for cleanup operations.","analysis":{"risk":"low","impact":"low","complexity":"low"},"score":0.95,"tasks":[{"id":"T1","title":"Add ILogger dependency to SignalRService","scope":"XhMonitor.Desktop/Services","action":"Update","description":"Inject ILogger<SignalRService> into SignalRService constructor to enable structured logging","modification_points":["XhMonitor.Desktop/Services/SignalRService.cs:7-30"],"implementation":["Add private readonly ILogger<SignalRService> _logger field after line 9","Add ILogger<SignalRService> logger parameter to both constructors (lines 22-30)","Initialize _logger = logger in both constructors","Update constructor calls in App.xaml.cs or DI container to provide logger"],"test":{"unit":["Verify SignalRService can be instantiated with logger parameter","Verify existing parameterless constructor still works with null logger","Verify logger is properly stored in _logger field"],"commands":["dotnet test XhMonitor.Tests --filter FullyQualifiedName~SignalRService"]},"acceptance":{"criteria":["ILogger<SignalRService> field added to class","Both constructors accept logger parameter","Logger is properly initialized in constructors","No compilation errors","Existing tests pass"],"verification":["Build project successfully","Run existing SignalRService tests","Verify no null reference exceptions"]},"commit":{"type":"refactor","scope":"desktop/services","message_template":"refactor(desktop/services): inject ILogger into SignalRService\n\nAdd ILogger<SignalRService> dependency to enable structured logging\nfor exception handling. Maintains backward compatibility with\nparameterless constructor."},"depends_on":[],"priority":1},{"id":"T2","title":"Replace empty catch with structured logging","scope":"XhMonitor.Desktop/Services","action":"Update","description":"Replace empty catch block in DisconnectAsync with proper exception logging","modification_points":["XhMonitor.Desktop/Services/SignalRService.cs:141-144"],"implementation":["Replace empty catch block with catch (Exception ex)","Add _logger?.LogWarning(ex, \"Failed to stop SignalR connection gracefully. Connection: {ConnectionId}\", _connection?.ConnectionId ?? \"unknown\")","Keep the non-throwing behavior (do not rethrow)","Add comment explaining why exception is not rethrown: // Ignore stop errors to ensure cleanup continues"],"test":{"unit":["Create test that triggers StopAsync exception","Verify exception is logged with correct log level (Warning)","Verify exception does not propagate to caller","Verify DisposeAsync continues after StopAsync failure"],"commands":["dotnet test XhMonitor.Tests --filter FullyQualifiedName~SignalRService"]},"acceptance":{"criteria":["Empty catch block replaced with catch (Exception ex)","Exception logged with LogWarning level","Log message includes connection context","Non-throwing behavior preserved","Comment explains exception handling strategy"],"verification":["Code review confirms logging implementation","Unit test verifies exception is logged","Integration test confirms cleanup continues on error"]},"commit":{"type":"fix","scope":"desktop/services","message_template":"fix(desktop/services): add logging to SignalRService exception handler\n\nReplace empty catch block in DisconnectAsync with structured logging.\nExceptions during connection stop are now logged at Warning level\nwith connection context, improving debuggability while maintaining\nnon-throwing cleanup behavior."},"depends_on":["T1"],"priority":2},{"id":"T3","title":"Add logging to deserialization exception handlers","scope":"XhMonitor.Desktop/Services","action":"Update","description":"Enhance existing Debug.WriteLine calls with structured ILogger calls for better production diagnostics","modification_points":["XhMonitor.Desktop/Services/SignalRService.cs:53-56","XhMonitor.Desktop/Services/SignalRService.cs:66-69","XhMonitor.Desktop/Services/SignalRService.cs:79-82","XhMonitor.Desktop/Services/SignalRService.cs:92-95","XhMonitor.Desktop/Services/SignalRService.cs:105-108"],"implementation":["Keep existing Debug.WriteLine for development debugging","Add _logger?.LogError(ex, \"Failed to deserialize {MessageType} from SignalR hub\", \"HardwareLimits\") after Debug.WriteLine","Repeat for all 5 message handlers (HardwareLimits, SystemUsage, ProcessMetrics, ProcessMetadata, metrics.latest)","Use LogError level since deserialization failures indicate data contract issues"],"test":{"unit":["Create test with malformed JSON for each message type","Verify both Debug.WriteLine and ILogger are called","Verify correct message type is logged","Verify exception details are captured"],"commands":["dotnet test XhMonitor.Tests --filter FullyQualifiedName~SignalRService"]},"acceptance":{"criteria":["All 5 deserialization catch blocks enhanced with ILogger","Debug.WriteLine preserved for development","LogError level used for production logging","Message type included in log context","No performance degradation in message handling"],"verification":["Code review confirms all handlers updated","Unit tests verify logging behavior","Performance test shows <5ms overhead per message"]},"commit":{"type":"fix","scope":"desktop/services","message_template":"fix(desktop/services): add structured logging to SignalR message handlers\n\nEnhance deserialization exception handlers with ILogger calls.\nMaintains Debug.WriteLine for development while adding production-grade\nlogging with message type context. Improves diagnostics for data\ncontract issues."},"depends_on":["T1"],"priority":3}],"is_bound":true,"bound_at":"2026-01-24T07:42:30.654Z"}
