{"id":"SOL-ISS-1769239097521-10-c3m5","description":"Implement IAsyncDisposable for classes with async cleanup operations to follow async disposal best practices","approach":"Add IAsyncDisposable implementation to LibreHardwareManager and SystemMetricProvider, following the pattern already established in SignalRService. Implement DisposeAsync() methods that properly handle async cleanup, and update Dispose() to call DisposeAsync().GetAwaiter().GetResult() for backward compatibility. Update DI registration to use DisposeAsync when available.","analysis":{"risk":"medium","impact":"medium","complexity":"medium"},"score":0.88,"tasks":[{"id":"T1","title":"Implement IAsyncDisposable in LibreHardwareManager","scope":"XhMonitor.Core/Services","action":"Update","description":"Add IAsyncDisposable interface and implement DisposeAsync() method in LibreHardwareManager","modification_points":["XhMonitor.Core/Services/LibreHardwareManager.cs:12 - class declaration","XhMonitor.Core/Services/LibreHardwareManager.cs:250-275 - Dispose() method"],"implementation":["Update class declaration to implement both IDisposable and IAsyncDisposable: 'public class LibreHardwareManager : ILibreHardwareManager, IAsyncDisposable'","Add new DisposeAsync() method that performs async cleanup","Move disposal logic from Dispose() to DisposeAsync()","Update Dispose() to call DisposeAsync().GetAwaiter().GetResult() for backward compatibility","Add async disposal of _updateLock using DisposeAsync() if available","Follow SignalRService pattern for implementation"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Core/XhMonitor.Core.csproj","dotnet test XhMonitor.Tests/XhMonitor.Tests.csproj --filter LibreHardwareManager"]},"acceptance":{"criteria":["IAsyncDisposable interface implemented","DisposeAsync() method properly disposes resources asynchronously","Dispose() calls DisposeAsync() for backward compatibility","Existing tests pass","No resource leaks"],"verification":["Verify class implements IAsyncDisposable","Verify DisposeAsync() is public and returns ValueTask","Run unit tests to verify disposal behavior","Check that _updateLock is disposed asynchronously"]},"commit":{"type":"refactor","scope":"core/services","message_template":"refactor(core/services): implement IAsyncDisposable in LibreHardwareManager\n\nAdd async disposal pattern to properly handle async resource cleanup,\npreventing blocking operations in Dispose(). Maintains backward compatibility."},"depends_on":[],"priority":1},{"id":"T2","title":"Implement IAsyncDisposable in SystemMetricProvider","scope":"XhMonitor.Core/Providers","action":"Update","description":"Add IAsyncDisposable interface and implement DisposeAsync() method in SystemMetricProvider","modification_points":["XhMonitor.Core/Providers/SystemMetricProvider.cs:14 - class declaration","XhMonitor.Core/Providers/SystemMetricProvider.cs:271-278 - Dispose() method"],"implementation":["Update class declaration to implement both IDisposable and IAsyncDisposable: 'public class SystemMetricProvider : ISystemMetricProvider, IAsyncDisposable'","Add new DisposeAsync() method that performs async cleanup","Move disposal logic from Dispose() to DisposeAsync()","Update Dispose() to call DisposeAsync().GetAwaiter().GetResult() for backward compatibility","Ensure _dxgiMonitor is disposed properly (it only implements IDisposable)","Follow SignalRService pattern for implementation"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Core/XhMonitor.Core.csproj","dotnet test XhMonitor.Tests/XhMonitor.Tests.csproj --filter SystemMetricProvider"]},"acceptance":{"criteria":["IAsyncDisposable interface implemented","DisposeAsync() method properly disposes resources asynchronously","Dispose() calls DisposeAsync() for backward compatibility","Existing tests pass","No resource leaks"],"verification":["Verify class implements IAsyncDisposable","Verify DisposeAsync() is public and returns ValueTask","Run unit tests to verify disposal behavior","Check that _dxgiMonitor is disposed properly"]},"commit":{"type":"refactor","scope":"core/providers","message_template":"refactor(core/providers): implement IAsyncDisposable in SystemMetricProvider\n\nAdd async disposal pattern to properly handle async resource cleanup,\npreventing blocking operations in Dispose(). Maintains backward compatibility."},"depends_on":["T1"],"priority":2},{"id":"T3","title":"Update ILibreHardwareManager interface","scope":"XhMonitor.Core/Interfaces","action":"Update","description":"Add IAsyncDisposable to ILibreHardwareManager interface","modification_points":["XhMonitor.Core/Interfaces/ILibreHardwareManager.cs - interface declaration"],"implementation":["Update interface declaration to inherit from IAsyncDisposable: 'public interface ILibreHardwareManager : IAsyncDisposable'","Verify interface matches implementation"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Core/XhMonitor.Core.csproj"]},"acceptance":{"criteria":["Interface inherits from IAsyncDisposable","Interface matches implementation","Code compiles without errors"],"verification":["Verify interface declaration includes IAsyncDisposable","Run dotnet build"]},"commit":{"type":"refactor","scope":"core/interfaces","message_template":"refactor(core/interfaces): add IAsyncDisposable to ILibreHardwareManager\n\nUpdate interface to support async disposal pattern."},"depends_on":["T2"],"priority":3},{"id":"T4","title":"Update ISystemMetricProvider interface","scope":"XhMonitor.Core/Interfaces","action":"Update","description":"Add IAsyncDisposable to ISystemMetricProvider interface","modification_points":["XhMonitor.Core/Interfaces/ISystemMetricProvider.cs - interface declaration"],"implementation":["Update interface declaration to inherit from IAsyncDisposable: 'public interface ISystemMetricProvider : IAsyncDisposable'","Verify interface matches implementation"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Core/XhMonitor.Core.csproj"]},"acceptance":{"criteria":["Interface inherits from IAsyncDisposable","Interface matches implementation","Code compiles without errors"],"verification":["Verify interface declaration includes IAsyncDisposable","Run dotnet build"]},"commit":{"type":"refactor","scope":"core/interfaces","message_template":"refactor(core/interfaces): add IAsyncDisposable to ISystemMetricProvider\n\nUpdate interface to support async disposal pattern."},"depends_on":["T3"],"priority":4},{"id":"T5","title":"Update DI container disposal","scope":"XhMonitor.Service","action":"Update","description":"Verify DI container properly handles IAsyncDisposable services","modification_points":["XhMonitor.Service/Program.cs - Service registration and disposal"],"implementation":["Review DI service registration for LibreHardwareManager and SystemMetricProvider","Verify ASP.NET Core DI container automatically calls DisposeAsync() for IAsyncDisposable services","Add comments if needed to document async disposal behavior","No code changes needed if DI container handles it automatically"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Service/XhMonitor.Service.csproj","dotnet test"]},"acceptance":{"criteria":["DI container properly disposes IAsyncDisposable services","Application shutdown cleanly disposes resources","All tests pass"],"verification":["Review ASP.NET Core DI documentation for IAsyncDisposable support","Test application startup and shutdown","Verify no resource leaks during shutdown"]},"commit":{"type":"docs","scope":"service","message_template":"docs(service): document async disposal in DI container\n\nAdd comments explaining ASP.NET Core automatic IAsyncDisposable handling."},"depends_on":["T4"],"priority":5}],"is_bound":true,"bound_at":"2026-01-24T07:40:13.099Z"}
