{"id":"SOL-ISS-20260127-002-m4p9","description":"在 SettingsViewModel 中保存原始 AdminMode 值，避免 Save_Click 中重复 API 请求","approach":"在 SettingsViewModel 加载设置时保存 _originalAdminMode 副本，Save_Click 直接对比当前值与原始值，无需再次请求 API。同时修复 Save_Click 中 new HttpClient() 的问题。","tasks":[{"id":"TASK-1","title":"在 SettingsViewModel 中添加原始值追踪","description":"添加 _originalAdminMode 字段，在 LoadSettingsAsync 成功后保存原始值","modification_points":[{"file":"XhMonitor.Desktop/ViewModels/SettingsViewModel.cs","changes":[{"location":"字段声明区域","action":"添加 private bool _originalAdminMode 字段"},{"location":"LoadSettingsAsync 方法","action":"在加载 AdminMode 后保存 _originalAdminMode = AdminMode"}]}],"implementation":["1. 在 SettingsViewModel 类中添加私有字段: private bool _originalAdminMode","2. 在 LoadSettingsAsync 方法中，解析 AdminMode 后添加: _originalAdminMode = AdminMode","3. 添加公共只读属性 OriginalAdminMode 供 SettingsWindow 访问"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Desktop"]},"acceptance":{"criteria":["SettingsViewModel 包含 _originalAdminMode 字段","LoadSettingsAsync 正确保存原始值","OriginalAdminMode 属性可访问"],"verification":["代码审查确认字段和属性存在","单步调试验证 LoadSettingsAsync 后 _originalAdminMode 值正确"]},"commit":{"type":"refactor","scope":"viewmodel","message_template":"refactor(viewmodel): 在 SettingsViewModel 中追踪原始 AdminMode 值"},"depends_on":[],"priority":1},{"id":"TASK-2","title":"修改 SettingsWindow.Save_Click 使用缓存的原始值","description":"移除 Save_Click 中的 API 请求，改用 ViewModel 中保存的原始值进行对比","modification_points":[{"file":"XhMonitor.Desktop/Windows/SettingsWindow.xaml.cs","changes":[{"line":"54-68","action":"删除 API 请求代码块"},{"line":"70","old":"adminModeChanged = _viewModel.AdminMode != currentAdminMode","new":"adminModeChanged = _viewModel.AdminMode != _viewModel.OriginalAdminMode"}]}],"implementation":["1. 删除 Save_Click 中第 54-68 行的 try-catch 块（API 请求获取 currentAdminMode）","2. 删除 var currentAdminMode = false 声明","3. 将第 70 行改为: adminModeChanged = _viewModel.AdminMode != _viewModel.OriginalAdminMode","4. 移除 new HttpClient() 调用"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Desktop"]},"acceptance":{"criteria":["Save_Click 中不再有 API 请求","Save_Click 中不再有 new HttpClient() 调用","AdminMode 变更检测逻辑正确"],"verification":["grep -r 'new.*HttpClient' XhMonitor.Desktop/Windows/SettingsWindow.xaml.cs 返回空","运行应用，修改 AdminMode 设置，验证变更检测正常工作"]},"commit":{"type":"perf","scope":"settings","message_template":"perf(settings): 移除 Save_Click 中的冗余 API 请求"},"depends_on":["TASK-1"],"priority":2}],"analysis":{"risk":"low","impact":"medium","complexity":"low"},"score":0.85,"is_bound":true,"bound_at":"2026-01-27T02:56:09.437Z"}
