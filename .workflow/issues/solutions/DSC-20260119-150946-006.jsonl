{"id":"SOL-DSC-20260119-150946-006-p3x8","description":"Decouple Desktop from Service by implementing service discovery mechanism","approach":"Create shared configuration file for service endpoints, implement IServiceDiscovery interface in Desktop to read endpoint configuration, replace hardcoded URLs with dynamic discovery","analysis":{"risk":"low","impact":"medium","complexity":"medium"},"score":0.85,"tasks":[{"id":"T1","title":"Create shared service configuration file","scope":"XhMonitor.Desktop","action":"Create","description":"Create service-endpoints.json configuration file to store service endpoint URLs","modification_points":["XhMonitor.Desktop/service-endpoints.json"],"implementation":["Create new file XhMonitor.Desktop/service-endpoints.json","Define JSON structure with ServiceEndpoints object containing ApiBaseUrl and SignalRUrl","Set ApiBaseUrl to http://localhost:35179","Set SignalRUrl to http://localhost:35179/hubs/metrics","Add JSON schema for validation","Configure file to be copied to output directory in csproj"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Desktop"]},"acceptance":{"criteria":["service-endpoints.json file exists in XhMonitor.Desktop/","JSON contains ApiBaseUrl and SignalRUrl fields","File configured to copy to output directory","Valid JSON format"],"verification":["Verify file exists at XhMonitor.Desktop/service-endpoints.json","Check JSON structure matches schema","Confirm file copied to bin/Debug/net8.0-windows/ after build"]},"commit":{"type":"feat","scope":"desktop","message_template":"feat(desktop): add service-endpoints.json for service discovery"},"depends_on":[],"priority":1},{"id":"T2","title":"Create IServiceDiscovery interface and implementation","scope":"XhMonitor.Desktop/Services","action":"Create","description":"Create service discovery interface and implementation to load endpoint configuration","modification_points":["XhMonitor.Desktop/Services/IServiceDiscovery.cs","XhMonitor.Desktop/Services/ServiceDiscovery.cs"],"implementation":["Create IServiceDiscovery interface with properties: ApiBaseUrl, SignalRUrl","Create ServiceDiscovery class implementing IServiceDiscovery","Implement constructor to load service-endpoints.json from application directory","Use System.Text.Json to deserialize configuration","Add error handling for missing or invalid configuration file","Provide fallback to default values (localhost:35179) if file not found","Add logging for configuration loading success/failure"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Desktop"]},"acceptance":{"criteria":["IServiceDiscovery interface defined with 2 properties","ServiceDiscovery class implements interface","Configuration loaded from service-endpoints.json","Fallback to defaults if file missing","Build succeeds without errors"],"verification":["Verify IServiceDiscovery.cs exists with ApiBaseUrl and SignalRUrl properties","Verify ServiceDiscovery.cs implements interface","Test configuration loading with valid and missing file scenarios","Run dotnet build and confirm success"]},"commit":{"type":"feat","scope":"desktop","message_template":"feat(desktop): implement IServiceDiscovery for dynamic endpoint resolution"},"depends_on":["T1"],"priority":2},{"id":"T3","title":"Register ServiceDiscovery in DI container","scope":"XhMonitor.Desktop","action":"Update","description":"Register IServiceDiscovery as singleton in App.xaml.cs dependency injection setup","modification_points":["XhMonitor.Desktop/App.xaml.cs"],"implementation":["Add using statement: using XhMonitor.Desktop.Services;","In OnStartup method after line 25, add: services.AddSingleton<IServiceDiscovery, ServiceDiscovery>();","Ensure ServiceDiscovery is registered before other services that depend on it","Verify DI container builds successfully"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Desktop"]},"acceptance":{"criteria":["IServiceDiscovery registered as singleton in App.xaml.cs","Registration occurs before dependent services","Build succeeds without errors","ServiceProvider resolves IServiceDiscovery successfully"],"verification":["Search App.xaml.cs for AddSingleton<IServiceDiscovery>","Verify registration order (before BackendServerService, WebServerService)","Run dotnet build and confirm success","Test application startup"]},"commit":{"type":"feat","scope":"desktop","message_template":"feat(desktop): register ServiceDiscovery in DI container"},"depends_on":["T2"],"priority":3},{"id":"T4","title":"Refactor SettingsViewModel to use IServiceDiscovery","scope":"XhMonitor.Desktop/ViewModels","action":"Update","description":"Replace hardcoded ApiBaseUrl with IServiceDiscovery injection in SettingsViewModel","modification_points":["XhMonitor.Desktop/ViewModels/SettingsViewModel.cs"],"implementation":["Add constructor parameter: IServiceDiscovery serviceDiscovery","Remove const string ApiBaseUrl at line 13","Add private readonly field: private readonly string _apiBaseUrl;","In constructor, assign: _apiBaseUrl = serviceDiscovery.ApiBaseUrl + \"/api/v1/config\";","Update LoadSettingsAsync line 108: use _apiBaseUrl instead of ApiBaseUrl","Update SaveSettingsAsync line 173: use _apiBaseUrl instead of ApiBaseUrl","Ensure HttpClient initialization remains unchanged"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Desktop"]},"acceptance":{"criteria":["SettingsViewModel constructor accepts IServiceDiscovery parameter","Hardcoded ApiBaseUrl constant removed","_apiBaseUrl field populated from serviceDiscovery","All API calls use _apiBaseUrl instead of hardcoded constant","Build succeeds without errors"],"verification":["Search SettingsViewModel.cs for hardcoded localhost:35179","Verify IServiceDiscovery injected in constructor","Confirm _apiBaseUrl used in LoadSettingsAsync and SaveSettingsAsync","Run dotnet build and confirm success"]},"commit":{"type":"refactor","scope":"desktop","message_template":"refactor(desktop): use IServiceDiscovery in SettingsViewModel"},"depends_on":["T3"],"priority":4},{"id":"T5","title":"Update SettingsWindow to pass IServiceDiscovery to ViewModel","scope":"XhMonitor.Desktop/Windows","action":"Update","description":"Modify SettingsWindow to resolve IServiceDiscovery from DI and pass to SettingsViewModel","modification_points":["XhMonitor.Desktop/Windows/SettingsWindow.xaml.cs"],"implementation":["Add constructor parameter: IServiceDiscovery serviceDiscovery","Update line 15: _viewModel = new SettingsViewModel(serviceDiscovery);","Ensure SettingsWindow is created via DI or manually passes serviceDiscovery","Update App.xaml.cs OpenSettingsWindow method to resolve IServiceDiscovery and pass to SettingsWindow constructor"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Desktop"]},"acceptance":{"criteria":["SettingsWindow constructor accepts IServiceDiscovery parameter","IServiceDiscovery passed to SettingsViewModel constructor","App.xaml.cs resolves IServiceDiscovery when creating SettingsWindow","Build succeeds without errors","Settings window opens successfully"],"verification":["Verify SettingsWindow constructor signature includes IServiceDiscovery","Check SettingsViewModel instantiation passes serviceDiscovery","Verify App.xaml.cs OpenSettingsWindow resolves IServiceDiscovery","Run application and test settings window"]},"commit":{"type":"refactor","scope":"desktop","message_template":"refactor(desktop): inject IServiceDiscovery into SettingsWindow"},"depends_on":["T4"],"priority":5},{"id":"T6","title":"Refactor BackendServerService to use configuration","scope":"XhMonitor.Desktop/Services","action":"Update","description":"Replace hardcoded BackendPort constant with configuration from IServiceDiscovery","modification_points":["XhMonitor.Desktop/Services/BackendServerService.cs"],"implementation":["Add constructor parameter: IServiceDiscovery serviceDiscovery","Remove const int BackendPort = 35179 at line 11","Add private readonly field: private readonly int _backendPort;","In constructor, parse port from serviceDiscovery.ApiBaseUrl using Uri class","Update all references to BackendPort to use _backendPort","Ensure port checking and process startup use dynamic port value"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Desktop"]},"acceptance":{"criteria":["BackendServerService constructor accepts IServiceDiscovery parameter","Hardcoded BackendPort constant removed","_backendPort field populated from serviceDiscovery.ApiBaseUrl","All port references use _backendPort instead of constant","Build succeeds without errors"],"verification":["Search BackendServerService.cs for hardcoded 35179","Verify IServiceDiscovery injected in constructor","Confirm _backendPort used in IsPortInUse and WaitForServerReady","Run dotnet build and confirm success"]},"commit":{"type":"refactor","scope":"desktop","message_template":"refactor(desktop): use IServiceDiscovery in BackendServerService"},"depends_on":["T3"],"priority":4},{"id":"T7","title":"Refactor WebServerService to use configuration","scope":"XhMonitor.Desktop/Services","action":"Update","description":"Replace hardcoded WebPort constant with configuration from IServiceDiscovery or ConfigurationDefaults","modification_points":["XhMonitor.Desktop/Services/WebServerService.cs"],"implementation":["Add constructor parameter: IServiceDiscovery serviceDiscovery (optional, or use ConfigurationDefaults)","Remove const int WebPort = 35180 at line 13","Add private readonly field: private readonly int _webPort;","In constructor, assign: _webPort = ConfigurationDefaults.System.WebPort (or from serviceDiscovery if added to config)","Update all references to WebPort to use _webPort","Ensure port checking and web server startup use dynamic port value"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Desktop"]},"acceptance":{"criteria":["WebServerService uses dynamic port configuration","Hardcoded WebPort constant removed","_webPort field populated from configuration source","All port references use _webPort instead of constant","Build succeeds without errors"],"verification":["Search WebServerService.cs for hardcoded 35180","Verify configuration source injected","Confirm _webPort used in IsPortInUse and StartAsync","Run dotnet build and confirm success"]},"commit":{"type":"refactor","scope":"desktop","message_template":"refactor(desktop): use configuration in WebServerService"},"depends_on":["T3"],"priority":4}],"is_bound":true,"bound_at":"2026-01-19T16:19:55.355Z"}
