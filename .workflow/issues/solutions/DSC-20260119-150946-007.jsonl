{"id":"SOL-DSC-20260119-150946-007-r9b5","description":"Clarify configuration boundaries between appsettings.json and database with clear separation of concerns","approach":"Define clear boundaries: appsettings.json for infrastructure/deployment settings (ports, paths, intervals), database for user-configurable runtime settings (UI preferences, keywords). Document boundaries and migrate overlapping settings.","analysis":{"risk":"medium","impact":"high","complexity":"medium"},"score":0.88,"tasks":[{"id":"T1","title":"Document configuration boundary rules","scope":"XhMonitor.Service","action":"Create","description":"Create configuration-boundaries.md documentation defining clear rules for what goes in appsettings.json vs database","modification_points":["XhMonitor.Service/docs/configuration-boundaries.md"],"implementation":["Create new file XhMonitor.Service/docs/configuration-boundaries.md","Document appsettings.json scope: Infrastructure settings (Server.Host, Server.Port, Server.HubPath), Deployment settings (Database.ConnectionString, MetricProviders.PluginDirectory), System intervals (Monitor.IntervalSeconds, Monitor.SystemUsageIntervalSeconds), Static configuration (Logging, CORS origins)","Document database (ApplicationSettings) scope: User-configurable runtime settings (Appearance: ThemeColor, Opacity), Data collection preferences (ProcessKeywords, TopProcessCount, DataRetentionDays), User system settings (StartWithWindows)","Add decision tree: Is it infrastructure/deployment? → appsettings.json; Is it user-configurable at runtime? → database; Does it require app restart? → appsettings.json; Can it change during runtime? → database","Add examples of each category with rationale","Document migration path for overlapping settings"],"test":{"unit":[],"commands":[]},"acceptance":{"criteria":["configuration-boundaries.md file exists with clear rules","appsettings.json scope documented with 4+ categories","Database scope documented with 3+ categories","Decision tree provided for classification","Examples included for each category"],"verification":["Verify file exists at XhMonitor.Service/docs/configuration-boundaries.md","Check all sections present: appsettings.json scope, database scope, decision tree, examples","Confirm clarity and completeness of rules"]},"commit":{"type":"docs","scope":"service","message_template":"docs(service): add configuration boundaries documentation"},"depends_on":[],"priority":1},{"id":"T2","title":"Remove port configuration from database","scope":"XhMonitor.Service/Data","action":"Update","description":"Remove SignalRPort and WebPort from ApplicationSettings database as these are infrastructure settings that belong in appsettings.json","modification_points":["XhMonitor.Service/Data/MonitorDbContext.cs","XhMonitor.Desktop/ViewModels/SettingsViewModel.cs","XhMonitor.Desktop/Windows/SettingsWindow.xaml","XhMonitor.Desktop/Windows/SettingsWindow.xaml.cs"],"implementation":["Remove SignalRPort and WebPort seed data from MonitorDbContext.cs (lines 89-90)","Create EF migration to remove these settings from database: dotnet ef migrations add RemovePortsFromDatabase","Remove SignalRPort and WebPort properties from SettingsViewModel.cs (lines 28-29, 61-62, 136-137, 169-170)","Remove SignalRPort and WebPort UI controls from SettingsWindow.xaml (lines 402-403, 405-406)","Update RestoreDefaults_Click in SettingsWindow.xaml.cs to remove port restoration (lines 61-62)","Add comment in code explaining ports are now in appsettings.json only"],"test":{"unit":[],"commands":["dotnet ef migrations add RemovePortsFromDatabase --project XhMonitor.Service","dotnet build XhMonitor.Service","dotnet build XhMonitor.Desktop"]},"acceptance":{"criteria":["SignalRPort and WebPort removed from database seed data","EF migration generated successfully","SettingsViewModel no longer has port properties","Settings UI no longer shows port configuration","RestoreDefaults no longer sets port values","Build succeeds for both Service and Desktop"],"verification":["Search MonitorDbContext.cs for SignalRPort and WebPort - should not exist","Verify migration file created","Search SettingsViewModel.cs for _signalRPort and _webPort - should not exist","Check SettingsWindow.xaml for port TextBox controls - should not exist","Run dotnet build for both projects"]},"commit":{"type":"refactor","scope":"service,desktop","message_template":"refactor: remove port configuration from database (belongs in appsettings.json)"},"depends_on":["T1"],"priority":2},{"id":"T3","title":"Consolidate interval configuration in appsettings.json","scope":"XhMonitor.Service","action":"Update","description":"Remove SystemInterval and ProcessInterval from database as these are system-level settings that should be in appsettings.json only","modification_points":["XhMonitor.Service/Data/MonitorDbContext.cs","XhMonitor.Service/appsettings.json","XhMonitor.Desktop/ViewModels/SettingsViewModel.cs","XhMonitor.Desktop/Windows/SettingsWindow.xaml","XhMonitor.Desktop/Windows/SettingsWindow.xaml.cs"],"implementation":["Verify appsettings.json already has Monitor.IntervalSeconds (line 3) and Monitor.SystemUsageIntervalSeconds (line 4)","Remove SystemInterval and ProcessInterval from database seed data in MonitorDbContext.cs (lines 83-84)","Create EF migration: dotnet ef migrations add RemoveIntervalsFromDatabase","Remove SystemInterval and ProcessInterval properties from SettingsViewModel.cs (lines 21-22, 56-57, 126-127, 161-162)","Remove interval UI controls from SettingsWindow.xaml","Update RestoreDefaults_Click to remove interval restoration (lines 56-57)","Add comment explaining intervals are configured in appsettings.json for system-wide consistency"],"test":{"unit":[],"commands":["dotnet ef migrations add RemoveIntervalsFromDatabase --project XhMonitor.Service","dotnet build XhMonitor.Service","dotnet build XhMonitor.Desktop"]},"acceptance":{"criteria":["SystemInterval and ProcessInterval removed from database","Intervals remain in appsettings.json as Monitor.IntervalSeconds and Monitor.SystemUsageIntervalSeconds","EF migration generated successfully","SettingsViewModel no longer has interval properties","Settings UI no longer shows interval configuration","Build succeeds for both projects"],"verification":["Verify appsettings.json contains Monitor.IntervalSeconds and Monitor.SystemUsageIntervalSeconds","Search MonitorDbContext.cs for SystemInterval and ProcessInterval - should not exist","Verify migration file created","Search SettingsViewModel.cs for _systemInterval and _processInterval - should not exist","Run dotnet build for both projects"]},"commit":{"type":"refactor","scope":"service,desktop","message_template":"refactor: move interval configuration to appsettings.json only"},"depends_on":["T1"],"priority":2},{"id":"T4","title":"Keep user-configurable settings in database","scope":"XhMonitor.Service/Data","action":"Verify","description":"Verify that user-configurable runtime settings remain in database: Appearance (ThemeColor, Opacity), ProcessKeywords, TopProcessCount, DataRetentionDays, StartWithWindows","modification_points":["XhMonitor.Service/Data/MonitorDbContext.cs"],"implementation":["Verify database seed data contains: ThemeColor, Opacity (Appearance category)","Verify database seed data contains: ProcessKeywords, TopProcessCount, DataRetentionDays (DataCollection category)","Verify database seed data contains: StartWithWindows (System category)","Confirm these settings are user-configurable at runtime via Settings UI","Ensure ConfigController.GetSettings and SaveSettings handle these settings","Add XML comments explaining why these settings are in database (user-configurable, runtime changes)"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Service"]},"acceptance":{"criteria":["Database contains 7 user-configurable settings: ThemeColor, Opacity, ProcessKeywords, TopProcessCount, DataRetentionDays, StartWithWindows, and any other UI preferences","Settings are accessible via ConfigController API","Settings can be modified at runtime without app restart","XML comments document rationale for database storage"],"verification":["Check MonitorDbContext.cs seed data for 7+ user settings","Verify ConfigController.GetSettings returns these settings","Test Settings UI can load and save these values","Confirm changes persist across app restarts"]},"commit":null,"depends_on":["T2","T3"],"priority":3},{"id":"T5","title":"Add configuration validation on startup","scope":"XhMonitor.Service","action":"Create","description":"Implement configuration validation to ensure appsettings.json and database settings are consistent and complete","modification_points":["XhMonitor.Service/Configuration/ConfigurationValidator.cs","XhMonitor.Service/Program.cs"],"implementation":["Create ConfigurationValidator class with ValidateConfiguration method","Validate required appsettings.json settings: Server.Port, Server.Host, Monitor.IntervalSeconds, Database.ConnectionString","Validate database ApplicationSettings table has required user settings","Check for conflicts: no duplicate settings between appsettings.json and database","Log validation results with clear error messages","In Program.cs, call ConfigurationValidator.ValidateConfiguration after builder creation (after line 70)","Throw exception if validation fails to prevent startup with invalid configuration"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Service","dotnet run --project XhMonitor.Service"]},"acceptance":{"criteria":["ConfigurationValidator class exists with validation logic","Validates required appsettings.json settings (4+ checks)","Validates database settings (3+ checks)","Detects configuration conflicts","Validation runs on application startup","Clear error messages for validation failures"],"verification":["Verify ConfigurationValidator.cs exists","Check validation logic covers appsettings.json and database","Test with missing appsettings.json values - should fail","Test with missing database settings - should fail","Run application and verify validation executes"]},"commit":{"type":"feat","scope":"service","message_template":"feat(service): add configuration validation on startup"},"depends_on":["T4"],"priority":4},{"id":"T6","title":"Update README with configuration guidance","scope":"Root","action":"Update","description":"Update README.md to document the configuration boundary rules and provide clear guidance on where to configure different settings","modification_points":["README.md"],"implementation":["Add new section 'Configuration Management' after line 812","Document appsettings.json settings: Server (Host, Port, HubPath), Monitor (IntervalSeconds, SystemUsageIntervalSeconds, Keywords), MetricProviders, Database (RetentionDays, CleanupIntervalHours)","Document database settings: Appearance (ThemeColor, Opacity), DataCollection (ProcessKeywords, TopProcessCount, DataRetentionDays), System (StartWithWindows)","Add table showing setting name, location (appsettings.json vs database), and rationale","Add note: 'Infrastructure settings require app restart, user settings take effect immediately'","Link to configuration-boundaries.md for detailed rules"],"test":{"unit":[],"commands":[]},"acceptance":{"criteria":["README.md contains Configuration Management section","appsettings.json settings documented with examples","Database settings documented with examples","Table shows setting locations and rationale","Clear guidance on when to use each configuration source"],"verification":["Verify Configuration Management section exists in README.md","Check table includes 10+ settings with locations","Confirm guidance is clear and actionable","Verify link to configuration-boundaries.md"]},"commit":{"type":"docs","scope":"root","message_template":"docs: update README with configuration management guidance"},"depends_on":["T1"],"priority":5}],"is_bound":true,"bound_at":"2026-01-19T16:19:58.164Z"}
