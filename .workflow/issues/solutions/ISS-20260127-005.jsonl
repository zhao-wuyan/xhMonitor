{"id":"SOL-ISS-20260127-005-p3v7","description":"在 ConfigurationDefaults 中添加 Keys 常量类，替换 SettingsViewModel 中的魔法字符串","approach":"SettingsViewModel 中使用魔法字符串访问配置字典（如 monitoring[\"MonitorCpu\"]）存在拼写错误风险且难以重构。解决方案是在 ConfigurationDefaults 中添加 Keys 嵌套类，定义所有配置键的字符串常量。这样做的好处：1) 键名有单一来源，与默认值定义在同一位置；2) 使用 nameof() 风格的常量名提高可读性；3) 编译时检查，避免拼写错误；4) IDE 支持重构和查找引用。实现时保持向后兼容，字符串值与现有键名完全一致。","tasks":[{"id":"T1","title":"在 ConfigurationDefaults 中添加 Keys 常量类","scope":"XhMonitor.Core/Configuration/ConfigurationDefaults.cs","action":"Update","description":"在 ConfigurationDefaults 中添加 Keys 嵌套类，定义所有配置键的字符串常量","modification_points":[{"file":"XhMonitor.Core/Configuration/ConfigurationDefaults.cs","target":"ConfigurationDefaults 类末尾 (line 125 后)","change":"添加 Keys 嵌套类，包含 Appearance、DataCollection、Monitoring、System 四个子类"}],"implementation":["在 ConfigurationDefaults.cs 的 System 类后（约 line 125）添加新的 Keys 嵌套类","Keys 类包含四个嵌套类：Appearance、DataCollection、Monitoring、System","Appearance.Keys: ThemeColor = \"ThemeColor\", Opacity = \"Opacity\"","DataCollection.Keys: ProcessKeywords = \"ProcessKeywords\", TopProcessCount = \"TopProcessCount\", DataRetentionDays = \"DataRetentionDays\"","Monitoring.Keys: MonitorCpu = \"MonitorCpu\", MonitorMemory = \"MonitorMemory\", MonitorGpu = \"MonitorGpu\", MonitorVram = \"MonitorVram\", MonitorPower = \"MonitorPower\", MonitorNetwork = \"MonitorNetwork\", AdminMode = \"AdminMode\"","System.Keys: StartWithWindows = \"StartWithWindows\"","添加 XML 注释说明这些常量用于类型安全的配置键访问"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Core"]},"acceptance":{"criteria":["Keys 嵌套类创建成功","包含所有配置键的字符串常量","常量值与现有配置键名完全一致","XML 注释说明用途"]},"commit":{"type":"refactor","scope":"Core","message_template":"refactor(Core): 在 ConfigurationDefaults 中添加 Keys 常量类"},"depends_on":[],"priority":1},{"id":"T2","title":"重构 SettingsViewModel 使用 Keys 常量","scope":"XhMonitor.Desktop/ViewModels/SettingsViewModel.cs","action":"Update","description":"将 SettingsViewModel 中的魔法字符串替换为 ConfigurationDefaults.Keys 常量","modification_points":[{"file":"XhMonitor.Desktop/ViewModels/SettingsViewModel.cs","target":"LoadSettingsAsync 方法 (line 148-180)","change":"将 appearance[\"ThemeColor\"] 替换为 appearance[ConfigurationDefaults.Keys.Appearance.ThemeColor] 等"},{"file":"XhMonitor.Desktop/ViewModels/SettingsViewModel.cs","target":"SaveSettingsAsync 方法 (line 195-223)","change":"将 [\"ThemeColor\"] = 替换为 [ConfigurationDefaults.Keys.Appearance.ThemeColor] = 等"}],"implementation":["在 LoadSettingsAsync 方法中，将 appearance[\"ThemeColor\"] 替换为 appearance[ConfigurationDefaults.Keys.Appearance.ThemeColor]","将 appearance[\"Opacity\"] 替换为 appearance[ConfigurationDefaults.Keys.Appearance.Opacity]","将 dataCollection[\"ProcessKeywords\"] 替换为 dataCollection[ConfigurationDefaults.Keys.DataCollection.ProcessKeywords]","依次替换所有 DataCollection、Monitoring、System 的键访问","在 SaveSettingsAsync 方法中，将字典初始化的键名替换为常量","例如 [\"ThemeColor\"] = 替换为 [ConfigurationDefaults.Keys.Appearance.ThemeColor] =","确保所有 14 个配置键都使用常量引用"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Desktop"]},"acceptance":{"criteria":["SettingsViewModel 中不再有配置键的魔法字符串","所有键访问使用 ConfigurationDefaults.Keys 常量","LoadSettingsAsync 中 14 个键访问全部替换","SaveSettingsAsync 中 14 个键访问全部替换","代码编译通过"]},"commit":{"type":"refactor","scope":"Desktop","message_template":"refactor(Desktop): SettingsViewModel 使用 Keys 常量替换魔法字符串\n\n- LoadSettingsAsync 使用类型安全的键访问\n- SaveSettingsAsync 使用类型安全的键访问\n- 消除 14 处魔法字符串\n\nCloses ISS-20260127-005"},"depends_on":["T1"],"priority":2}],"analysis":{"risk":"low","impact":"medium","complexity":"low"},"score":0.92,"is_bound":true,"bound_at":"2026-01-27T02:57:11.865Z"}
