{"id":"SOL-DSC-20260119-150946-009-p3x8","description":"Implement strongly-typed SignalR hub using IMetricsClient interface to replace magic strings with compile-time safe method calls","approach":"Define IMetricsClient interface with typed methods for all SignalR events, update MetricsHub to use strongly-typed hub, refactor Worker.cs to call typed methods instead of SendAsync with string event names, and update client-side event subscriptions to match new method names","analysis":{"risk":"medium","impact":"medium","complexity":"medium"},"score":0.88,"tasks":[{"id":"T1","title":"Create IMetricsClient Strongly-Typed Hub Interface","scope":"XhMonitor.Core/Interfaces","action":"Create","description":"Define IMetricsClient interface with typed methods corresponding to all SignalR events currently sent via magic strings","modification_points":[],"implementation":["Create new file: XhMonitor.Core/Interfaces/IMetricsClient.cs","Add namespace: namespace XhMonitor.Core.Interfaces;","Define interface with methods matching SignalR events from SignalREvents.cs:","  - Task ReceiveHardwareLimits(object data); // maps to SignalREvents.HardwareLimits","  - Task ReceiveSystemUsage(object data); // maps to SignalREvents.SystemUsage","  - Task ReceiveProcessMetrics(object data); // maps to SignalREvents.ProcessMetrics","  - Task ReceiveProcessMetadata(object data); // maps to SignalREvents.ProcessMetadata","Add XML documentation for each method describing the data payload structure","Consider using strongly-typed DTOs instead of 'object' for better type safety (optional enhancement)"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Core/XhMonitor.Core.csproj"]},"acceptance":{"criteria":["IMetricsClient interface created in XhMonitor.Core/Interfaces/","Interface contains 4 methods: ReceiveHardwareLimits, ReceiveSystemUsage, ReceiveProcessMetrics, ReceiveProcessMetadata","All methods return Task","All methods have XML documentation","Build succeeds without errors"],"verification":["Verify file exists: XhMonitor.Core/Interfaces/IMetricsClient.cs","Confirm interface has exactly 4 methods matching SignalR events","Check XML documentation is present for each method","Run dotnet build XhMonitor.Core and confirm success"]},"commit":{"type":"feat","scope":"core/signalr","message_template":"feat(core/signalr): add IMetricsClient strongly-typed hub interface\n\nDefine typed client interface for SignalR hub to replace magic strings\nwith compile-time safe method calls. Includes methods for hardware limits,\nsystem usage, process metrics, and process metadata events.\n\nRelated: DSC-20260119-150946-009"},"depends_on":[],"priority":1},{"id":"T2","title":"Update MetricsHub to Use Strongly-Typed Client Interface","scope":"XhMonitor.Service/Hubs/MetricsHub.cs","action":"Update","description":"Change MetricsHub inheritance to use strongly-typed Hub<IMetricsClient> instead of Hub","modification_points":["XhMonitor.Service/Hubs/MetricsHub.cs:8"],"implementation":["Open MetricsHub.cs","Add using directive: using XhMonitor.Core.Interfaces;","Change class declaration from 'public sealed class MetricsHub : Hub' to 'public sealed class MetricsHub : Hub<IMetricsClient>'","Update SendProcessMetadataAsync method (line 40):","  - Replace 'await Clients.Caller.SendAsync(SignalREvents.ProcessMetadata, new { ... });'","  - With 'await Clients.Caller.ReceiveProcessMetadata(new { ... });'","Verify constructor and other methods remain unchanged"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Service/XhMonitor.Service.csproj"]},"acceptance":{"criteria":["MetricsHub inherits from Hub<IMetricsClient>","SendProcessMetadataAsync uses Clients.Caller.ReceiveProcessMetadata() instead of SendAsync","Using directive for XhMonitor.Core.Interfaces added","Build succeeds without errors","No magic strings remain in MetricsHub.cs"],"verification":["Verify class declaration: public sealed class MetricsHub : Hub<IMetricsClient>","Confirm using XhMonitor.Core.Interfaces; directive exists","Check SendProcessMetadataAsync uses ReceiveProcessMetadata method","Run dotnet build XhMonitor.Service and confirm success","Search for 'SendAsync' in MetricsHub.cs - should find none"]},"commit":{"type":"refactor","scope":"service/signalr","message_template":"refactor(service/signalr): use strongly-typed Hub<IMetricsClient>\n\nUpdate MetricsHub to inherit from Hub<IMetricsClient> and replace\nSendAsync calls with typed method invocations for compile-time safety.\n\nRelated: DSC-20260119-150946-009"},"depends_on":["T1"],"priority":2},{"id":"T3","title":"Refactor Worker.cs to Use Strongly-Typed Hub Context","scope":"XhMonitor.Service/Worker.cs","action":"Update","description":"Update Worker.cs to inject IHubContext<MetricsHub, IMetricsClient> and replace all SendAsync calls with typed method invocations","modification_points":["XhMonitor.Service/Worker.cs:17","XhMonitor.Service/Worker.cs:151","XhMonitor.Service/Worker.cs:198","XhMonitor.Service/Worker.cs:237","XhMonitor.Service/Worker.cs:269","XhMonitor.Service/Worker.cs:312"],"implementation":["Open Worker.cs","Add using directive: using XhMonitor.Core.Interfaces;","Update field declaration (line 17):","  - From: private readonly IHubContext<MetricsHub> _hubContext;","  - To: private readonly IHubContext<MetricsHub, IMetricsClient> _hubContext;","Update constructor parameter to match new type","Refactor SendMemoryLimitAsync method (line 151):","  - Replace: await _hubContext.Clients.All.SendAsync(SignalREvents.HardwareLimits, new { ... }, ct);","  - With: await _hubContext.Clients.All.ReceiveHardwareLimits(new { ... });","  - Note: Remove 'ct' parameter as typed methods don't accept CancellationToken in payload","Refactor UpdateVramLimitAsync method (line 198):","  - Replace: await _hubContext.Clients.All.SendAsync(SignalREvents.HardwareLimits, new { ... }, ct);","  - With: await _hubContext.Clients.All.ReceiveHardwareLimits(new { ... });","Refactor SendSystemUsageAsync method (line 237):","  - Replace: await _hubContext.Clients.All.SendAsync(SignalREvents.SystemUsage, new { ... }, ct);","  - With: await _hubContext.Clients.All.ReceiveSystemUsage(new { ... });","Refactor SendProcessDataAsync method (line 269):","  - Replace: await _hubContext.Clients.All.SendAsync(SignalREvents.ProcessMetadata, new { ... }, ct);","  - With: await _hubContext.Clients.All.ReceiveProcessMetadata(new { ... });","Refactor RunProcessPushLoopAsync method (line 312):","  - Replace: await _hubContext.Clients.All.SendAsync(SignalREvents.ProcessMetrics, new { ... }, stoppingToken);","  - With: await _hubContext.Clients.All.ReceiveProcessMetrics(new { ... });","Remove SignalREvents constant references (they're no longer needed)","Consider keeping SignalREvents.cs for documentation or remove if unused elsewhere"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Service/XhMonitor.Service.csproj"]},"acceptance":{"criteria":["Worker.cs uses IHubContext<MetricsHub, IMetricsClient>","All 5 SendAsync calls replaced with typed method calls","No magic strings (SignalREvents constants) used in hub invocations","CancellationToken parameters removed from hub method calls","Build succeeds without errors","No compilation warnings related to SignalR"],"verification":["Verify field type: IHubContext<MetricsHub, IMetricsClient> _hubContext;","Confirm using XhMonitor.Core.Interfaces; directive exists","Search for 'SendAsync' in Worker.cs - should find none in hub context calls","Verify all 5 methods use typed calls: ReceiveHardwareLimits (2x), ReceiveSystemUsage, ReceiveProcessMetadata, ReceiveProcessMetrics","Run dotnet build XhMonitor.Service and confirm success","Check for any SignalREvents references in hub calls - should find none"]},"commit":{"type":"refactor","scope":"service/worker","message_template":"refactor(service/worker): use strongly-typed hub context in Worker\n\nReplace IHubContext<MetricsHub> with IHubContext<MetricsHub, IMetricsClient>\nand refactor all SendAsync calls to use typed method invocations. Eliminates\nmagic strings and provides compile-time safety for SignalR events.\n\nRelated: DSC-20260119-150946-009"},"depends_on":["T2"],"priority":3},{"id":"T4","title":"Update Desktop Client SignalR Event Subscriptions","scope":"XhMonitor.Desktop/Services/SignalRService.cs","action":"Update","description":"Update client-side event subscriptions to use new method names matching IMetricsClient interface","modification_points":["XhMonitor.Desktop/Services/SignalRService.cs:48-97"],"implementation":["Open SignalRService.cs","Update event subscription method names to match IMetricsClient:","  - Line 48: Change 'SignalREvents.HardwareLimits' to 'ReceiveHardwareLimits'","  - Line 60: Change 'SignalREvents.SystemUsage' to 'ReceiveSystemUsage'","  - Line 73: Change 'SignalREvents.ProcessMetrics' to 'ReceiveProcessMetrics'","  - Line 86: Change 'SignalREvents.ProcessMetadata' to 'ReceiveProcessMetadata'","Keep the legacy 'metrics.latest' subscription (line 99) if still in use, or remove if deprecated","Update SignalREvents constant references to use string literals directly","Consider removing SignalREvents.cs from Desktop project if no longer needed"],"test":{"unit":[],"commands":["dotnet build XhMonitor.Desktop/XhMonitor.Desktop.csproj","dotnet run --project XhMonitor.Desktop/XhMonitor.Desktop.csproj"]},"acceptance":{"criteria":["All 4 event subscriptions use new method names: ReceiveHardwareLimits, ReceiveSystemUsage, ReceiveProcessMetrics, ReceiveProcessMetadata","Event handlers remain unchanged (only subscription names updated)","Build succeeds without errors","Application runs and receives SignalR events successfully","FloatingWindow displays real-time metrics correctly"],"verification":["Verify _connection.On calls use new method names (ReceiveHardwareLimits, etc.)","Confirm event handler logic unchanged (JsonSerializer.Deserialize, event invocations)","Run dotnet build XhMonitor.Desktop and confirm success","Launch application and verify SignalR connection establishes","Confirm real-time metrics display in FloatingWindow (CPU, Memory, GPU, VRAM)","Check Debug output for successful event reception"]},"commit":{"type":"refactor","scope":"desktop/signalr","message_template":"refactor(desktop/signalr): update client event subscriptions for typed hub\n\nUpdate SignalR event subscription names to match IMetricsClient interface\nmethod names. Maintains compatibility with strongly-typed hub implementation.\n\nRelated: DSC-20260119-150946-009"},"depends_on":["T3"],"priority":4},{"id":"T5","title":"Update Web Client SignalR Event Subscriptions","scope":"xhmonitor-web/src/hooks/useMetricsHub.ts","action":"Update","description":"Update TypeScript web client event subscriptions to use new method names matching IMetricsClient interface","modification_points":["xhmonitor-web/src/hooks/useMetricsHub.ts:59-78"],"implementation":["Open useMetricsHub.ts","Update event subscription method names:","  - Line 59: Change 'metrics.processes' to 'ReceiveProcessMetrics'","  - Line 66: Change 'metrics.processes.meta' to 'ReceiveProcessMetadata'","Check for other SignalR event subscriptions in the file","Update any hardcoded event name strings to match IMetricsClient method names","Consider creating a TypeScript constants file for event names to maintain consistency"],"test":{"unit":[],"commands":["cd xhmonitor-web && npm run build","cd xhmonitor-web && npm run dev"]},"acceptance":{"criteria":["Event subscriptions use new method names: ReceiveProcessMetrics, ReceiveProcessMetadata","Event handler logic remains unchanged","TypeScript compilation succeeds without errors","Web application runs and receives SignalR events successfully","Metrics display correctly in web interface"],"verification":["Verify connection.on calls use new method names","Confirm event handler logic unchanged (data processing, state updates)","Run npm run build in xhmonitor-web and confirm success","Launch web dev server with npm run dev","Open browser to http://localhost:5173 and verify SignalR connection","Confirm real-time metrics display correctly in web UI"]},"commit":{"type":"refactor","scope":"web/signalr","message_template":"refactor(web/signalr): update client event subscriptions for typed hub\n\nUpdate SignalR event subscription names in TypeScript client to match\nIMetricsClient interface method names for consistency with backend.\n\nFixes: DSC-20260119-150946-009"},"depends_on":["T3"],"priority":4}],"is_bound":true,"bound_at":"2026-01-19T16:19:40.892Z"}
