<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XhMonitor 组件库示例</title>

    <!-- 引入组件样式 -->
    <link rel="stylesheet" href="../core/design-tokens.css">
    <link rel="stylesheet" href="../core/glass-panel.css">
    <link rel="stylesheet" href="../core/stat-card.css">

    <style>
        .demo-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .demo-section {
            margin-bottom: 60px;
        }

        .demo-section__title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--xh-color-text-primary);
        }

        .demo-section__description {
            font-size: 1rem;
            color: var(--xh-color-text-secondary);
            margin-bottom: 30px;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        @media (max-width: 1200px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr; }
        }

        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--xh-color-glass-border);
            border-radius: var(--xh-radius-md);
            padding: 20px;
            overflow-x: auto;
            font-family: var(--xh-font-mono);
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .code-block code {
            color: #e0e0e0;
        }

        .demo-panel-content {
            padding: 20px;
        }

        .demo-panel-content h3 {
            margin-bottom: 10px;
            color: var(--xh-color-text-primary);
        }

        .demo-panel-content p {
            color: var(--xh-color-text-secondary);
            line-height: 1.6;
        }

        .color-swatch {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            vertical-align: middle;
            margin-right: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .token-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .token-table th,
        .token-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--xh-color-glass-border);
        }

        .token-table th {
            color: var(--xh-color-text-secondary);
            font-weight: 600;
        }

        .token-table td {
            color: var(--xh-color-text-primary);
            font-family: var(--xh-font-mono);
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <!-- 标题 -->
        <header style="margin-bottom: 60px; text-align: center;">
            <h1 style="font-size: 3rem; margin-bottom: 10px;">XhMonitor 组件库</h1>
            <p style="font-size: 1.2rem; color: var(--xh-color-text-secondary);">
                玻璃拟态设计 · 实时数据可视化 · 响应式布局
            </p>
        </header>

        <!-- 1. 设计 Tokens -->
        <section class="demo-section">
            <h2 class="demo-section__title">设计 Tokens</h2>
            <p class="demo-section__description">
                从 ui-preview-v2.html 提取的设计系统，包含颜色、排版、间距、动画等。
            </p>

            <div class="xh-glass-panel xh-glass-panel--padded">
                <h3 style="margin-bottom: 20px;">语义色（监控指标）</h3>
                <table class="token-table">
                    <thead>
                        <tr>
                            <th>颜色</th>
                            <th>Token</th>
                            <th>值</th>
                            <th>用途</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="color-swatch" style="background: var(--xh-color-cpu)"></span></td>
                            <td>--xh-color-cpu</td>
                            <td>#3b82f6</td>
                            <td>CPU 使用率</td>
                        </tr>
                        <tr>
                            <td><span class="color-swatch" style="background: var(--xh-color-ram)"></span></td>
                            <td>--xh-color-ram</td>
                            <td>#8b5cf6</td>
                            <td>RAM 使用量</td>
                        </tr>
                        <tr>
                            <td><span class="color-swatch" style="background: var(--xh-color-gpu)"></span></td>
                            <td>--xh-color-gpu</td>
                            <td>#10b981</td>
                            <td>GPU 使用率</td>
                        </tr>
                        <tr>
                            <td><span class="color-swatch" style="background: var(--xh-color-vram)"></span></td>
                            <td>--xh-color-vram</td>
                            <td>#f59e0b</td>
                            <td>VRAM 使用量</td>
                        </tr>
                        <tr>
                            <td><span class="color-swatch" style="background: var(--xh-color-net)"></span></td>
                            <td>--xh-color-net</td>
                            <td>#0ea5e9</td>
                            <td>网络流量</td>
                        </tr>
                        <tr>
                            <td><span class="color-swatch" style="background: var(--xh-color-pwr)"></span></td>
                            <td>--xh-color-pwr</td>
                            <td>#f43f5e</td>
                            <td>功耗</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- 2. GlassPanel 组件 -->
        <section class="demo-section">
            <h2 class="demo-section__title">GlassPanel - 玻璃拟态面板</h2>
            <p class="demo-section__description">
                半透明背景和毛玻璃效果的容器组件。
            </p>

            <div class="demo-grid">
                <!-- 基础面板 -->
                <div class="xh-glass-panel demo-panel-content">
                    <h3>基础面板</h3>
                    <p>默认样式，无内边距。</p>
                    <div class="code-block">
                        <code>&lt;div class="xh-glass-panel"&gt;...&lt;/div&gt;</code>
                    </div>
                </div>

                <!-- 带内边距 -->
                <div class="xh-glass-panel xh-glass-panel--padded">
                    <h3>带内边距</h3>
                    <p>使用 --padded 变体，内边距 20px。</p>
                    <div class="code-block">
                        <code>&lt;div class="xh-glass-panel xh-glass-panel--padded"&gt;...&lt;/div&gt;</code>
                    </div>
                </div>

                <!-- 紧凑内边距 -->
                <div class="xh-glass-panel xh-glass-panel--compact">
                    <h3>紧凑内边距</h3>
                    <p>使用 --compact 变体，内边距 12px。</p>
                    <div class="code-block">
                        <code>&lt;div class="xh-glass-panel xh-glass-panel--compact"&gt;...&lt;/div&gt;</code>
                    </div>
                </div>

                <!-- 高亮边框 -->
                <div class="xh-glass-panel xh-glass-panel--highlight xh-glass-panel--padded">
                    <h3>高亮边框</h3>
                    <p>使用 --highlight 变体，边框更明显。</p>
                    <div class="code-block">
                        <code>&lt;div class="xh-glass-panel xh-glass-panel--highlight"&gt;...&lt;/div&gt;</code>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. StatCard 组件 -->
        <section class="demo-section">
            <h2 class="demo-section__title">StatCard - 资源监控卡片</h2>
            <p class="demo-section__description">
                用于显示系统资源使用情况，信息叠加在实时图表上。支持峰谷值标记和左侧渐隐效果。
            </p>

            <div class="stats-grid">
                <!-- CPU Card -->
                <div class="xh-stat-card xh-glass-panel" style="--accent: var(--xh-color-cpu)">
                    <div class="xh-stat-card__glow" style="background: var(--accent)"></div>
                    <div class="xh-stat-card__info">
                        <div class="xh-stat-card__label">
                            <span style="color: var(--accent)">●</span> CPU
                            <span class="xh-stat-card__label-indicator" id="cpu-temp">· --°C</span>
                        </div>
                        <div class="xh-stat-card__value" id="cpu-value">0%</div>
                        <div class="xh-stat-card__subtitle">i9-13900K</div>
                    </div>
                    <div class="xh-stat-card__chart" id="chart-area-cpu">
                        <canvas id="chart-cpu" class="xh-stat-card__canvas"></canvas>
                    </div>
                </div>

                <!-- RAM Card -->
                <div class="xh-stat-card xh-glass-panel" style="--accent: var(--xh-color-ram)">
                    <div class="xh-stat-card__glow" style="background: var(--accent)"></div>
                    <div class="xh-stat-card__info">
                        <div class="xh-stat-card__label">
                            <span style="color: var(--accent)">●</span> RAM
                        </div>
                        <div class="xh-stat-card__value" id="ram-value">0 GB</div>
                        <div class="xh-stat-card__subtitle">/ 32 GB</div>
                    </div>
                    <div class="xh-stat-card__chart" id="chart-area-ram">
                        <canvas id="chart-ram" class="xh-stat-card__canvas"></canvas>
                    </div>
                </div>

                <!-- GPU Card -->
                <div class="xh-stat-card xh-glass-panel" style="--accent: var(--xh-color-gpu)">
                    <div class="xh-stat-card__glow" style="background: var(--accent)"></div>
                    <div class="xh-stat-card__info">
                        <div class="xh-stat-card__label">
                            <span style="color: var(--accent)">●</span> GPU
                            <span class="xh-stat-card__label-indicator" id="gpu-temp">· --°C</span>
                        </div>
                        <div class="xh-stat-card__value" id="gpu-value">0%</div>
                        <div class="xh-stat-card__subtitle">RTX 4090</div>
                    </div>
                    <div class="xh-stat-card__chart" id="chart-area-gpu">
                        <canvas id="chart-gpu" class="xh-stat-card__canvas"></canvas>
                    </div>
                </div>

                <!-- VRAM Card -->
                <div class="xh-stat-card xh-glass-panel" style="--accent: var(--xh-color-vram)">
                    <div class="xh-stat-card__glow" style="background: var(--accent)"></div>
                    <div class="xh-stat-card__info">
                        <div class="xh-stat-card__label">
                            <span style="color: var(--accent)">●</span> VRAM
                        </div>
                        <div class="xh-stat-card__value" id="vram-value">0 GB</div>
                        <div class="xh-stat-card__subtitle">/ 24 GB</div>
                    </div>
                    <div class="xh-stat-card__chart" id="chart-area-vram">
                        <canvas id="chart-vram" class="xh-stat-card__canvas"></canvas>
                    </div>
                </div>

                <!-- Network Card -->
                <div class="xh-stat-card xh-glass-panel" style="--accent: var(--xh-color-net)">
                    <div class="xh-stat-card__glow" style="background: var(--accent)"></div>
                    <div class="xh-stat-card__info">
                        <div class="xh-stat-card__label">
                            <span style="color: var(--accent)">●</span> NET
                        </div>
                        <div class="xh-stat-card__value xh-stat-card__value--small" id="net-value">0 KB/s</div>
                        <div class="xh-stat-card__subtitle">
                            <span id="net-up">↑ 0</span> <span style="margin:0 4px; opacity:0.3">|</span> <span id="net-down">↓ 0</span>
                        </div>
                    </div>
                    <div class="xh-stat-card__chart" id="chart-area-net">
                        <canvas id="chart-net" class="xh-stat-card__canvas"></canvas>
                    </div>
                </div>

                <!-- Power Card -->
                <div class="xh-stat-card xh-glass-panel" style="--accent: var(--xh-color-pwr)">
                    <div class="xh-stat-card__glow" style="background: var(--accent)"></div>
                    <div class="xh-stat-card__info">
                        <div class="xh-stat-card__label">
                            <span style="color: var(--accent)">●</span> PWR
                        </div>
                        <div class="xh-stat-card__value" id="pwr-value">0 W</div>
                        <div class="xh-stat-card__subtitle" id="pwr-max">Max: -- W</div>
                    </div>
                    <div class="xh-stat-card__chart" id="chart-area-pwr">
                        <canvas id="chart-pwr" class="xh-stat-card__canvas"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. 代码示例 -->
        <section class="demo-section">
            <h2 class="demo-section__title">代码示例</h2>
            <p class="demo-section__description">
                完整的 JavaScript 初始化代码。
            </p>

            <div class="xh-glass-panel xh-glass-panel--padded">
                <div class="code-block">
<code>// 1. 创建图表实例
const cpuChart = new MiniChart(
  'chart-cpu',
  'chart-area-cpu',
  '#3b82f6',
  v => v.toFixed(0) + '%'
);

// 2. 准备数据缓冲区
const cpuData = new Array(40).fill(0);

// 3. 更新循环
setInterval(() => {
  // 移除最旧数据，添加最新数据
  cpuData.shift();
  cpuData.push(30 + Math.random() * 40);

  // 绘制图表
  cpuChart.draw(cpuData, 100);

  // 更新数值显示
  document.getElementById('cpu-value').innerText =
    cpuData[cpuData.length - 1].toFixed(1) + '%';
}, 1000);

// 4. 网络流量使用动态缩放
const netScaler = new DynamicScaler(20480, 3000);
const netData = new Array(40).fill(0);

setInterval(() => {
  netData.shift();
  netData.push(Math.random() * 1024 * 20);

  // 动态调整 Y 轴上限
  const currentMax = netScaler.update(netData);
  netChart.draw(netData, currentMax);
}, 1000);</code>
                </div>
            </div>
        </section>

        <!-- 页脚 -->
        <footer style="margin-top: 80px; padding-top: 40px; border-top: 1px solid var(--xh-color-glass-border); text-align: center; color: var(--xh-color-text-secondary);">
            <p>XhMonitor 组件库 v1.0.0</p>
            <p style="margin-top: 10px;">从 ui-preview-v2.html 提取的设计系统</p>
        </footer>
    </div>

    <!-- 引入图表引擎 -->
    <script src="../charts/MiniChart.js"></script>
    <script src="../charts/DynamicScaler.js"></script>

    <!-- 初始化图表 -->
    <script>
        // 数据流模拟
        class DataStream {
            constructor() {
                this.cpu = new Array(40).fill(0);
                this.gpu = new Array(40).fill(0);
                this.ram = new Array(40).fill(0);
                this.vram = new Array(40).fill(0);
                this.net = new Array(40).fill(0);
                this.pwr = new Array(40).fill(0);
                this.tick = 0;
                this.maxPwr = 0;
            }

            next() {
                this.tick++;
                const cpuVal = 30 + Math.sin(this.tick * 0.2) * 20 + Math.random() * 10;
                const gpuVal = 40 + Math.cos(this.tick * 0.15) * 30 + Math.random() * 5;
                const ramVal = 60 + Math.sin(this.tick * 0.05) * 5;
                const vramVal = gpuVal * 0.8 + 10;
                const netVal = Math.random() * 1024 * 20;
                const pwrVal = 50 + cpuVal * 1.5 + gpuVal * 2.5 + Math.random() * 20;

                if (pwrVal > this.maxPwr) this.maxPwr = pwrVal;

                this.shiftAndPush(this.cpu, this.clamp(cpuVal));
                this.shiftAndPush(this.gpu, this.clamp(gpuVal));
                this.shiftAndPush(this.ram, this.clamp(ramVal));
                this.shiftAndPush(this.vram, this.clamp(vramVal));
                this.shiftAndPush(this.net, netVal);
                this.shiftAndPush(this.pwr, (pwrVal / 600) * 100);

                return {
                    cpu: this.last(this.cpu),
                    gpu: this.last(this.gpu),
                    ram: this.last(this.ram),
                    vram: this.last(this.vram),
                    net: this.last(this.net),
                    pwr: pwrVal,
                    pwrMax: this.maxPwr
                };
            }

            shiftAndPush(arr, val) {
                arr.shift();
                arr.push(val);
            }

            last(arr) { return arr[arr.length - 1]; }
            clamp(val) { return Math.min(100, Math.max(0, val)); }
        }

        // 初始化
        const stream = new DataStream();
        const style = getComputedStyle(document.body);
        const netScaler = new DynamicScaler(20480);

        // 格式化函数
        const fmtPercent = v => v.toFixed(0) + '%';
        const fmtRamGB = v => (v / 100 * 32).toFixed(1) + 'G';
        const fmtVramGB = v => (v / 100 * 24).toFixed(1) + 'G';
        const fmtNet = v => {
            if (v > 1024 * 1024) return (v / (1024 * 1024)).toFixed(1) + 'G';
            if (v > 1024) return (v / 1024).toFixed(1) + 'M';
            return v.toFixed(0) + 'K';
        };
        const fmtPwr = v => v.toFixed(0) + 'W';

        // 创建图表实例
        const charts = {
            cpu: new MiniChart('chart-cpu', 'chart-area-cpu', style.getPropertyValue('--xh-color-cpu').trim(), fmtPercent),
            ram: new MiniChart('chart-ram', 'chart-area-ram', style.getPropertyValue('--xh-color-ram').trim(), fmtRamGB),
            gpu: new MiniChart('chart-gpu', 'chart-area-gpu', style.getPropertyValue('--xh-color-gpu').trim(), fmtPercent),
            vram: new MiniChart('chart-vram', 'chart-area-vram', style.getPropertyValue('--xh-color-vram').trim(), fmtVramGB),
            net: new MiniChart('chart-net', 'chart-area-net', style.getPropertyValue('--xh-color-net').trim(), fmtNet),
            pwr: new MiniChart('chart-pwr', 'chart-area-pwr', style.getPropertyValue('--xh-color-pwr').trim(), fmtPwr),
        };

        // 主更新循环
        function update() {
            const current = stream.next();

            // 更新图表
            charts.cpu.draw(stream.cpu);
            charts.ram.draw(stream.ram);
            charts.gpu.draw(stream.gpu);
            charts.vram.draw(stream.vram);

            // 网络流量使用动态缩放
            const netMax = netScaler.update(stream.net);
            charts.net.draw(stream.net, netMax);

            // 功耗固定 600W 上限
            charts.pwr.draw(stream.pwr, 600);

            // 更新数值显示
            document.getElementById('cpu-value').innerText = current.cpu.toFixed(1) + '%';
            document.getElementById('cpu-temp').innerText = '· ' + (40 + current.cpu * 0.5).toFixed(0) + '°C';

            const ramGB = (current.ram / 100 * 32).toFixed(1);
            document.getElementById('ram-value').innerText = ramGB + ' GB';

            document.getElementById('gpu-value').innerText = current.gpu.toFixed(1) + '%';
            document.getElementById('gpu-temp').innerText = '· ' + (35 + current.gpu * 0.6).toFixed(0) + '°C';

            const vramGB = (current.vram / 100 * 24).toFixed(1);
            document.getElementById('vram-value').innerText = vramGB + ' GB';

            const netKB = current.net;
            let netStr = netKB.toFixed(0) + ' KB/s';
            if (netKB > 1024) netStr = (netKB / 1024).toFixed(1) + ' MB/s';
            document.getElementById('net-value').innerText = netStr;

            const netUp = netKB * 0.2;
            const netDown = netKB * 0.8;
            const fmtSpeed = (kb) => kb > 1024 ? (kb/1024).toFixed(1)+'M' : kb.toFixed(0)+'K';
            document.getElementById('net-up').innerText = '↑ ' + fmtSpeed(netUp);
            document.getElementById('net-down').innerText = '↓ ' + fmtSpeed(netDown);

            document.getElementById('pwr-value').innerText = current.pwr.toFixed(0) + ' W';
            document.getElementById('pwr-max').innerText = 'Max: ' + current.pwrMax.toFixed(0) + ' W';
        }

        // 启动更新循环
        setInterval(update, 1000);
        update();

        // 初始 Resize
        setTimeout(() => {
            Object.values(charts).forEach(c => c.resize());
        }, 100);
    </script>
</body>
</html>
