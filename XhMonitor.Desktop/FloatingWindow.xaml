<Window x:Class="XhMonitor.Desktop.FloatingWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="XhMonitor"
        Width="420" Height="300"
        MinWidth="240" MinHeight="180"
        WindowStyle="None"
        ResizeMode="CanResizeWithGrip"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False">

    <Border Background="#CC1A1A1A"
            CornerRadius="12"
            BorderBrush="#33FFFFFF"
            BorderThickness="1"
            Padding="16">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 系统摘要 -->
            <StackPanel Grid.Row="0" Margin="0,0,0,12">
                <Grid Margin="0,0,0,8">
                    <TextBlock Text="System Summary"
                               FontSize="14"
                               FontWeight="Bold"
                               Foreground="White"
                               VerticalAlignment="Center"/>

                    <!-- 连接状态指示器 -->
                    <Ellipse Width="8" Height="8"
                             HorizontalAlignment="Right"
                             VerticalAlignment="Center">
                        <Ellipse.Style>
                            <Style TargetType="Ellipse">
                                <Setter Property="Fill" Value="#FFFF0000"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsConnected}" Value="True">
                                        <Setter Property="Fill" Value="#FF00FF00"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Ellipse.Style>
                    </Ellipse>
                </Grid>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- CPU -->
                    <Border Grid.Column="0" Grid.Row="0"
                            Background="#22FF6B6B"
                            CornerRadius="8"
                            Padding="12,8"
                            Margin="0,0,4,4">
                        <StackPanel>
                            <TextBlock Text="CPU"
                                       FontSize="10"
                                       Foreground="#FFAAAAAA"/>
                            <TextBlock Text="{Binding TotalCpu, StringFormat={}{0:F1}%}"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       Foreground="#FFFF6B6B"/>
                        </StackPanel>
                    </Border>

                    <!-- Memory -->
                    <Border Grid.Column="1" Grid.Row="0"
                            Background="#2250C878"
                            CornerRadius="8"
                            Padding="12,8"
                            Margin="4,0,0,4">
                        <StackPanel>
                            <TextBlock Text="Memory"
                                       FontSize="10"
                                       Foreground="#FFAAAAAA"/>
                            <TextBlock Text="{Binding TotalMemory, StringFormat={}{0:F0} MB}"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       Foreground="#FF50C878"/>
                        </StackPanel>
                    </Border>

                    <!-- GPU -->
                    <Border Grid.Column="0" Grid.Row="1"
                            Background="#224FC3F7"
                            CornerRadius="8"
                            Padding="12,8"
                            Margin="0,4,4,0">
                        <StackPanel>
                            <TextBlock Text="GPU"
                                       FontSize="10"
                                       Foreground="#FFAAAAAA"/>
                            <TextBlock Text="{Binding TotalGpu, StringFormat={}{0:F1}%}"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       Foreground="#FF4FC3F7"/>
                        </StackPanel>
                    </Border>

                    <!-- VRAM -->
                    <Border Grid.Column="1" Grid.Row="1"
                            Background="#22FFA726"
                            CornerRadius="8"
                            Padding="12,8"
                            Margin="4,4,0,0">
                        <StackPanel>
                            <TextBlock Text="VRAM"
                                       FontSize="10"
                                       Foreground="#FFAAAAAA"/>
                            <TextBlock Text="{Binding TotalVram, StringFormat={}{0:F0} MB}"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       Foreground="#FFFFA726"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </StackPanel>

            <!-- 进程列表 -->
            <ListView Grid.Row="1"
                      ItemsSource="{Binding TopProcesses}"
                      Background="Transparent"
                      BorderThickness="0"
                      ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListViewItem">
                                    <ContentPresenter/>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ListView.ItemContainerStyle>
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border Background="#11FFFFFF"
                                CornerRadius="6"
                                Padding="8"
                                Margin="0,2">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0"
                                           Text="{Binding ProcessName}"
                                           Foreground="White"
                                           FontSize="12"
                                           VerticalAlignment="Center"
                                           TextTrimming="CharacterEllipsis"/>

                                <TextBlock Grid.Column="1"
                                           Foreground="#FFFF6B6B"
                                           FontSize="12"
                                           FontWeight="Bold"
                                           VerticalAlignment="Center"
                                           Margin="8,0,0,0">
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0:F1}%">
                                            <Binding Path="Metrics[cpu].Value"/>
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>
    </Border>
</Window>
